<!DOCTYPE html>
<html lang="el">
<head>
    <script src="libs/NoSleep.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta charset="UTF-8">
    

    <title>Presentation Timer</title>
    <style>
        html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    box-sizing: border-box;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        
      body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #2c3e50;
    color: white;
    overflow: hidden;  /* Î‘Î›Î›Î‘Î“Î—: Î±Ï€ÏŒ auto ÏƒÎµ hidden */
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
/* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: DPI scaling fixes */
zoom: 1;
transform: scale(1);
width: 100vw;
height: 100vh;
margin: 0;
padding: 0;
}

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

       header {
    background-color: rgba(0, 0, 0, 0.3);
    text-align: center;
    padding: 0.5vh 0;
    font-weight: bold;
    /* Î‘Î¦Î‘Î™Î¡Î•Î˜Î—ÎšÎ•: font-size: 3vh; Î³Î¹Î± Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î»Î»Î¬Î¶ÎµÎ¹ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ */
}

        .main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    padding: 0;
    margin-top: -5vh;
    height: calc(100vh - 8vh);
    transition: all 0.5s ease;
    margin-bottom: 0; /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î‘Ï†Î±Î¯ÏÎµÏƒÎ· ÎºÎ¬Ï„Ï‰ margin */
}

/* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Classes Î³Î¹Î± Î´Ï…Î½Î±Î¼Î¹ÎºÎ® Î±Î»Î»Î±Î³Î® */
.main-content.with-message {
    justify-content: flex-start;
    padding-top: 3vh;
}

.main-content.no-message {
    justify-content: center;
    padding-top: 0;
}

        .connection-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #c0392b;
            font-size: 0.8rem;
            font-weight: bold;
            display: none; /* Hidden by default, shown on disconnect */
        }

        .timer {
            font-size: 25vh;
            font-weight: bold;
            text-align: center;
            margin: 4vh 0;
            transition: font-size 0.5s ease-in-out;
        }

        .timer.warning {
            color: #f39c12;
        }

        .timer.danger {
            color: #e74c3c;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Pulsating effect Î³Î¹Î± overtime */
        @keyframes pulsating {
            0% { 
                opacity: 0.6; 
                transform: scale(1);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05);
            }
            100% { 
                opacity: 0.6; 
                transform: scale(1);
            }
        }

.timer.overtime {
    color: #e74c3c;
    animation: pulsating 1.5s ease-in-out infinite;
    transform-origin: center center;
}

        .progress-container {
            width: 80%;
            max-width: 600px;
            height: 30px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin: 0 auto;
            overflow: hidden;
            transition: width 0.5s ease;
        }
        
        .progress-container.no-message {
            width: 95%;
            max-width: 1600px;
        }

        .progress-bar {
            height: 100%;
            width: 100%;
            background-color: #3498db;
            border-radius: 15px;
            transition: width 1s linear;
        }

        .progress-bar.warning {
            background-color: #f39c12;
        }

        .progress-bar.danger {
            background-color: #e74c3c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        @keyframes pulse {
    0% { opacity: 0.8; }
    50% { opacity: 1; }
    100% { opacity: 0.8; }
}
/* Î Î¿Î»Ï Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ Flash - Î¼ÏŒÎ½Î¿ Î±Î»Î»Î±Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚ */
@keyframes flash-alert {
    0% { 
        color: #ffffff;
    }
    50% { 
        color: #ff6b6b;
    }
    100% { 
        color: #ffffff;
    }
}

.timer-preview.flash-alert,
.timer.flash-alert,
#message-preview.flash-alert,
#message.flash-alert {
    animation: flash-alert 1.2s ease-in-out infinite;
}

.timer.flash-alert {
    animation: flash-alert 0.5s infinite;
}

#message.flash-alert {
    animation: flash-alert 0.5s infinite;
}

/* Question elements flash animation */
.question-from-line.flash-alert,
.question-to-line.flash-alert,
.question-subject-line.flash-alert,
.question-text-content.flash-alert {
    animation: flash-alert 0.5s infinite;
}

/* Î”Î™Î•Î“Î¡Î‘Î¦Î—: Duplicate .timer.overtime rule - Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ */


#message.overtime {
    animation: pulsating 2s infinite;
}


        .message-container {
    width: 90%;
    max-width: 90%;
    margin: 0vh auto 1vh auto;
    text-align: center;
    max-width: 1920px;
    max-height: 55vh; /* ÎœÎ•Î™Î©Î£Î—: Î±Ï€ÏŒ 40vh ÏƒÎµ 35vh Î³Î¹Î± mobile safety */
    margin-top: 1px;
    overflow: visible;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    flex: 1;
    padding-bottom: 0vh; /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î‘ÏƒÏ†Î±Î»Î­Ï‚ ÎºÎµÎ½ÏŒ Î±Ï€ÏŒ ÎºÎ¬Ï„Ï‰ */
}

#message {
    background-color: transparent;
    padding: 5px;
    border-radius: 0;
    font-size: 20vh;
    font-weight: normal;
    min-height: auto;
    max-height: 60vh; /* Î‘Î¥ÎÎ—Î£Î—: Î±Ï€ÏŒ 25vh ÏƒÎµ 40vh */
    display: flex;
    align-items: center;
    justify-content: center;
    transition: font-size 0.4s ease;
    word-wrap: break-word;
    overflow-wrap: break-word;
    
    text-align: center;
    line-height: 1.2;
    overflow: visible;
    width: 100%;
    white-space: normal; /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ line breaks */
    word-break: keep-all; /* Î‘Î›Î›Î‘Î“Î—: Î±Ï€ÏŒ break-word ÏƒÎµ keep-all */
overflow-wrap: anywhere; /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— */
hyphens: none; /* Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— */
}
        #message:empty {
            opacity: 0;
        }
        /* ========== SECONDARY TIMER STYLES (vMix) ========== */
        .secondary-timer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.911);
            border: 2px solid #e74c3c;
            border-radius: 0;
            padding: 5vh 5vw;
            text-align: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            animation: slideInRight 0.5s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        
        .secondary-timer-title {
            font-size: clamp(2rem, 6vh, 5rem);
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 4vh;
            overflow: hidden;
            text-align: center;
        }
        
        .secondary-timer-subtitle {
            font-size: clamp(3rem, 8vh, 8rem);
            font-weight: bold;
            color: #ffc400;
            margin-bottom: 4vh;
            text-align: center;
            line-height: 1;
        }
        
        .secondary-timer-time {
            font-size: clamp(4rem, 16vh, 25rem);
            font-weight: bold;
            color: #36acca;
            margin-bottom: 4vh;
            text-shadow: 0 0 3px rgb(255, 255, 255);
            line-height: 1;
            text-align: center;
        }
        
        .secondary-timer-progress {
            width: 100%;
            height: 12px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .secondary-progress-bar {
            height: 100%;
            background: #00cc44;
            border-radius: 4px;
            transition: width 0.3s ease, background-color 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 204, 68, 0.5);
        }
        
        .secondary-progress-bar.warning {
            background: #ff9500;
            box-shadow: 0 0 10px rgba(255, 149, 0, 0.5);
        }
        
        .secondary-progress-bar.danger {
            background: #ff3b30;
            box-shadow: 0 0 10px rgba(255, 59, 48, 0.5);
        }
        
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .secondary-timer.slide-out {
            animation: slideOutRight 0.8s ease-in-out forwards;
        }
        
        /* Enhanced responsive Î³Î¹Î± mobile */
        @media (max-width: 768px) {
            .secondary-timer {
                padding: 3vh 3vw;
                border-radius: 0;
                border: none;
            }
            
            .secondary-timer-title {
                font-size: clamp(1.2rem, 4vh, 2rem);
                margin-bottom: 2vh;
            }
            
            .secondary-timer-subtitle {
                font-size: clamp(1.5rem, 5vh, 3rem);
                margin-bottom: 2vh;
            }
            
            .secondary-timer-time {
                font-size: clamp(2.5rem, 12vh, 4rem);
                margin-bottom: 2vh;
            }
            
            .secondary-timer-progress {
                height: 8px;
                width: 90vw;
            }
        }
        
        /* Extra small devices */
        @media (max-width: 480px) {
            .secondary-timer {
                padding: 2vh 2vw;
                border-radius: 0;
                border: none;
            }
            
            .secondary-timer-title {
                font-size: clamp(1rem, 3vh, 1.5rem);
                margin-bottom: 1.5vh;
            }
            
            .secondary-timer-subtitle {
                font-size: clamp(1.2rem, 4vh, 2rem);
                margin-bottom: 1.5vh;
            }
            
            .secondary-timer-time {
                font-size: clamp(2rem, 10vh, 3rem);
                margin-bottom: 1.5vh;
            }
            
            .secondary-timer-progress {
                width: 95vw;
            }
        }

        #message.automatic-message {
    font-size: min(20vh, 6vw) !important;
    line-height: 1.0 !important;
    white-space: pre-line !important;
    text-align: center !important;
}

        /* Logo containers */
       .logo {
    width: 8vh; /* Î‘Î½Ï„Î¯ Î³Î¹Î± pixels, Ï‡ÏÎ®ÏƒÎ· viewport height */
    height: 8vh;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    position: absolute;
    display: none;
}

        .logo.tl {
            top: 40px;
            left: 10px;
        }
        
        .logo.tc {
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
        }

        .logo.tr {
            top: 40px;
            right: 10px;
        }

        .logo.bl {
            bottom: 10px;
            left: 10px;
        }
        
        .logo.bc {
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .logo.br {
            bottom: 10px;
            right: 10px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            
            header {
                font-size: 2.5vh;
                padding: 1.5vh 0;
            }

            .timer {
                font-size: 20vh;
                margin: 3vh 0;
            }

            .progress-container {
                width: 90%;
                height: 20px;
            }

            #message {
                font-size: 6vh;
                padding: 15px;
            }

            .logo {
                width: 6vh;
                height: 6vh;
            }
        }

        @media (max-width: 480px) {
            header {
                font-size: 2vh;
                padding: 1vh 0;
            }

            .timer {
                font-size: 15vh;
                margin: 2vh 0;
            }

            .progress-container {
                width: 95%;
                height: 15px;
            }

            #message {
                font-size: 5vh;
                padding: 10px;
            }

            .logo {
                width: 5vh;
                height: 5vh;
            }
        }

        @media (orientation: landscape) and (max-height: 600px) {
            header {
                font-size: 4vh;
                padding: 1vh 0;
            }
            
            .timer {
                font-size: 30vh;
                margin: 2vh 0;
            }
            
            .progress-container {
                height: 4vh;
            }
            
            #message {
                font-size: 8vh;
                padding: 2vh;
            }
            
            .logo {
                width: 10vh;
                height: 10vh;
            }
        }
        /* Styling Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ */


/* Responsive adjustments */
@media (max-width: 768px) {
    .question-from-line,
    .question-to-line {
        font-size: 2vh !important;
    }
    
    .question-subject-line {
        font-size: 2.5vh !important;
    }
    
    .question-text-content {
        font-size: 3vh !important;
    }
}
    </style>
</head>
<body>
    <!-- Right-click context menu -->
    <div id="contextMenu" style="position: fixed; background: #2c3e50; border: 1px solid #34495e; border-radius: 4px; padding: 8px 0; display: none; z-index: 9999; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
        <div id="setPcName" style="padding: 8px 16px; cursor: pointer; color: white; font-size: 14px; transition: background 0.2s;" onmouseover="this.style.background='#34495e'" onmouseout="this.style.background='transparent'">
            ğŸ’» Set PC Name
        </div>
    </div>
    
    <!-- Custom input dialog -->
    <div id="pcNameDialog" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: #2c3e50; padding: 20px; border-radius: 8px; color: white; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
            <h3 style="margin-top: 0; color: #ecf0f1;">ğŸ’» ÎŒÎ½Î¿Î¼Î± Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®</h3>
            <input type="text" id="pcNameInput" style="width: 200px; padding: 8px; margin: 10px 0; border: none; border-radius: 4px; font-size: 16px; text-align: center;" placeholder="Ï€.x. ASUS">
            <div style="margin-top: 15px;">
                <button id="pcNameOk" style="background: #27ae60; color: white; border: none; padding: 8px 16px; margin: 0 5px; border-radius: 4px; cursor: pointer; font-size: 14px;">OK</button>
                <button id="pcNameCancel" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; margin: 0 5px; border-radius: 4px; cursor: pointer; font-size: 14px;">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
            </div>
        </div>
    </div>
    <div class="container">
        <header id="title-preview">
    Presentation Timer
</header>
        
        <div class="connection-status" id="connection-status">
            Î‘Ï€Î¿ÏƒÏ…Î½Î´Î­Î¸Î·ÎºÎµ
        </div>
        
        <div class="main-content">
            <!-- Logo positions -->
            <div class="logo tl" id="logo-tl"></div>
            <div class="logo tc" id="logo-tc"></div>
            <div class="logo tr" id="logo-tr"></div>
            
            <div class="timer" id="timer">00:00</div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="message-container">
                <div id="message"></div>
            </div>
            
            <!-- vMix Video Timer -->
            <div class="secondary-timer" id="secondary-timer" style="display: none;">
                <div class="secondary-timer-title" id="secondary-timer-title">Video Title</div>
                <div class="secondary-timer-subtitle">Î¤Î­Î»Î¿Ï‚ Î’Î¯Î½Ï„ÎµÎ¿ ÏƒÎµ:</div>
                <div class="secondary-timer-time" id="secondary-timer-time">00:00</div>
                <div class="secondary-timer-progress" id="secondary-timer-progress">
                    <div class="secondary-progress-bar" id="secondary-progress-bar"></div>
                </div>
            </div>
            
            <!-- Bottom logo positions -->
            <div class="logo bl" id="logo-bl"></div>
            <div class="logo bc" id="logo-bc"></div>
            <div class="logo br" id="logo-br"></div>
        </div>
        
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        
        // Global variables
        let socket;
        let timeLeft =900; // 15 minutes default
        let originalTime = 900;
        let warningThreshold = 60;
        let isRunning = false;
        let timerInterval;
        let reconnectAttempts = 0;
        let isConnecting = false;
        let isMessageVisible = true;
        let hasReceivedFullState = false;
        let clockMode = false; // false = timer display, true = current time display
        

        const MAX_RECONNECT_ATTEMPTS = 5;
        const RECONNECT_DELAY = 3000;

        // Sound setup
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let soundEnabled = true;
        let soundVolume = 0.7;
        

        // Connect to Socket.IO server
        function connectSocket() {
            if (isConnecting) return; // Î‘Ï€Î¿Ï„ÏÎ¿Ï€Î® multiple connections
            isConnecting = true;
            
            socket = io();
            
            socket.on('connect', () => {
                document.getElementById('connection-status').style.display = 'none';
                reconnectAttempts = 0;
                isConnecting = false;
                
                // Î Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ saved PC name
                const savedPcName = localStorage.getItem('pcName');
                const hostname = savedPcName && savedPcName.trim() ? savedPcName.trim() : 'Timer-Display';
                
                console.log('ğŸ” Sending hostname to server:', hostname);
                socket.emit('registerClient', {
                    type: 'viewer',
                    role: 'display',
                    hostname: hostname
                });

                // Send current timer state along with requestFullState (for server restart sync)
                socket.emit('requestFullState', {
                    currentTimerState: {
                        timeLeft: timeLeft,
                        originalTime: originalTime,
                        isRunning: isRunning
                    }
                });
            });
            
            // PING/PONG HANDLERS Î³Î¹Î± heartbeat
            socket.on('ping', () => {
                socket.emit('pong');
            });

            socket.on('pong', () => {
                // Server received our ping
            });
            
            // Questions display events
    socket.on('displayQuestion', (data) => {
        displayQuestionOnScreen(data.question);
    });

    socket.on('hideQuestion', (data) => {
        hideQuestionFromScreen();
    });

            socket.on('disconnect', () => {
                document.getElementById('connection-status').style.display = 'block';
                isConnecting = false;
                if (reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
                    setTimeout(() => {
                        reconnectAttempts++;
                        connectSocket();
                    }, RECONNECT_DELAY);
                }
            });

            // Listen for command events
            socket.on('command', (data) => {
                handleCommand(data);
            });

            // Listen for time adjustment
            socket.on('adjustTime', (data) => {
                timeLeft += data.seconds;
                if (timeLeft < 0) timeLeft = 0;
                updateTimerDisplay();
                updateProgressBar();
            });

            // Listen for timer updates
            socket.on('timerUpdate', (data) => {
                timeLeft = data.timeLeft;
                updateTimerDisplay();
                updateProgressBar();
                
                // Apply warning/danger states
                const timerElement = document.getElementById('timer');
                // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î¼ÏŒÎ½Î¿ Ï„Ï‰Î½ state classes, Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Ï„Ï‰Î½ animation classes
                timerElement.classList.remove('warning', 'danger');
                if (!timerElement.classList.contains('timer')) {
                    timerElement.classList.add('timer');
                }
                
                if (data.status === 'warning') {
                    timerElement.classList.add('warning');
                } else if (data.status === 'danger' || timeLeft <= 0) {
                    // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÎºÏŒÎºÎºÎ¹Î½Î¿Ï… Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚ ÏŒÏ„Î±Î½ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ Ï„ÎµÎ»ÎµÎ¹ÏÏƒÎµÎ¹
                    timerElement.classList.add('danger');
                }
                
                // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· overtime class Î³Î¹Î± animation Î±Î½ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î±ÏÎ½Î·Ï„Î¹ÎºÏŒÏ‚
                if (timeLeft < 0) {
                    timerElement.classList.add('overtime');
                }
            });

            // Listen for message updates
socket.on('messageUpdate', (data) => {
    const messageElement = document.getElementById('message');
    if (messageElement) {
        
        // ÎÎ•ÎŸÎ£ Î¤Î¡ÎŸÎ ÎŸÎ£: ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÏÏÏ„Î·ÏƒÎ· ÎºÎ±Î¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÏƒÏ‰ÏƒÏ„Î¿Ï formatting
        if (data.message && data.message.includes('Î•ÏÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ:') && data.message.includes('Î˜Î­Î¼Î±:')) {
            
            // Î Î‘Î¡Î£Î™ÎÎ“Îš Ï„Î·Ï‚ ÎµÏÏÏ„Î·ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î¿ plain text
            const lines = data.message.split('\n').filter(line => line.trim());
            
            const fromLine = lines.find(line => line.includes('Î•ÏÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ:')) || 'Î•ÏÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ: -';
            const toLine = lines.find(line => line.includes('Î•ÏÏÏ„Î·ÏƒÎ· Ï€ÏÎ¿Ï‚:')) || 'Î•ÏÏÏ„Î·ÏƒÎ· Ï€ÏÎ¿Ï‚: -';
            const subjectLine = lines.find(line => line.includes('Î˜Î­Î¼Î±:')) || 'Î˜Î­Î¼Î±: -';
            
            const subjectIndex = lines.findIndex(line => line.includes('Î˜Î­Î¼Î±:'));
            const questionText = subjectIndex >= 0 && subjectIndex < lines.length - 1 
                ? lines.slice(subjectIndex + 1).join(' ').trim() 
                : 'ÎšÎµÎ¯Î¼ÎµÎ½Î¿ ÎµÏÏÏ„Î·ÏƒÎ·Ï‚';
            
            // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î§Î¡Î©ÎœÎ‘Î¤Î™Î£Î¤ÎŸÎ¥ HTML Î³Î¹Î± ÎµÏÏÏ„Î·ÏƒÎ·
            const questionHTML = `
                <div class="question-display">
                    <div class="question-from-line" style="font-size: 2.5vh; color: #3498db; font-weight: bold; margin-bottom: 1vh; text-align: center;">
                        ${fromLine}
                    </div>
                    <div class="question-to-line" style="font-size: 2.5vh; color: #2ecc71; font-weight: bold; margin-bottom: 1vh; text-align: center;">
                        ${toLine}
                    </div>
                    <div class="question-subject-line" style="font-size: 3vh; color: #f39c12; font-weight: bold; margin-bottom: 2vh; text-align: center;">
                        ${subjectLine}
                    </div>
                    <div class="question-text-content" style="font-size: 3.5vh; color: #ffffff; line-height: 1.4; text-align: center;">
                        ${questionText}
                    </div>
                </div>
            `;
            
            messageElement.innerHTML = questionHTML;
            
            // Î•Î¹Î´Î¹ÎºÏŒ styling Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚
            messageElement.style.textAlign = 'center';
            messageElement.style.lineHeight = '1.5';
            messageElement.style.display = 'flex';
            messageElement.style.flexDirection = 'column';
            messageElement.style.alignItems = 'center';
            messageElement.style.justifyContent = 'center';
            
            // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Responsive font scaling Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚
            adjustQuestionFontSize(messageElement, questionHTML);
            
            
        } else {
            // ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒ Î¼Î®Î½Ï…Î¼Î±
            messageElement.textContent = data.message;
            adjustMessageFontSize(messageElement, data.message);
            
            // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ styling Î³Î¹Î± ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬ Î¼Î·Î½ÏÎ¼Î±Ï„Î±
            messageElement.style.textAlign = '';
            messageElement.style.lineHeight = '';
            messageElement.style.display = '';
            messageElement.style.flexDirection = '';
            messageElement.style.alignItems = '';
            messageElement.style.justifyContent = '';
            
        }
        
        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î•Î¹Î´Î¹ÎºÏŒ styling Î³Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ Î¼Î®Î½Ï…Î¼Î± Î´ÏÎ¿ Î³ÏÎ±Î¼Î¼ÏÎ½
        if (data.message === 'Î¤Î•Î›ÎŸÎ£\nÎ§Î¡ÎŸÎÎŸÎ¥') {
            messageElement.classList.add('automatic-message');
        } else {
            messageElement.classList.remove('automatic-message');
        }
        
        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚ timer ÏŒÏ„Î±Î½ Î­ÏÏ‡ÎµÏ„Î±Î¹ Î¼Î®Î½Ï…Î¼Î±
        const hasMessage = data.message && data.message.trim() !== '';
        adjustTimerSize(hasMessage && isMessageVisible);
    }
});

            // Listen for settings updates
            socket.on('settingsUpdate', (data) => {
                handleSettingsUpdate(data);
            });

            // Listen for full state update
socket.on('fullStateUpdate', (state) => {
    console.log('Received full state update:', state);

    // ğŸ”„ SMART SYNC: Only update timer if local timer is NOT running
    // If local timer is running, it's the source of truth (server restart scenario)
    if (!isRunning) {
        timeLeft = state.timeLeft;
        originalTime = state.originalTime;
        isRunning = state.isRunning;
        console.log('â±ï¸ Timer state updated from server');
    } else {
        console.log('â­ï¸ Local timer running - keeping local state');
    }

    warningThreshold = state.warningThreshold;

    // Update display
    updateTimerDisplay();
    updateProgressBar();
    
    // Update title Î Î¡Î©Î¤Î‘
    if (state.title) {
    const titleElement = document.getElementById('title-preview');
        titleElement.textContent = state.title;
        document.title = state.title;
        
        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î•Ï†Î±ÏÎ¼Î¿Î³Î® custom font size Î±Ï€ÏŒ Ï„Î¿ state
        if (state.displaySettings && state.displaySettings.titleFontSize) {
            titleElement.style.fontSize = state.displaySettings.titleFontSize + 'px';
        }
    }
    
    // Update message - Î’Î•Î›Î¤Î™Î©Î£Î—: ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ fullState
if (state.message !== undefined) {
    const messageElement = document.getElementById('message');
    if (messageElement) {
        
        // Î•Î›Î•Î“Î§ÎŸÎ£: Î‘Î½ ÎµÎ¯Î½Î±Î¹ ÎµÏÏÏ„Î·ÏƒÎ·, Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎµ Ï„Î¿ Ï‡ÏÏ‰Î¼Î±Ï„Î¹ÏƒÏ„ÏŒ layout
        if (state.message.includes('Î•ÏÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ:') && state.message.includes('Î˜Î­Î¼Î±:')) {
            
            // Î Î‘Î¡Î£Î™ÎÎ“Îš Ï„Î·Ï‚ ÎµÏÏÏ„Î·ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î¿ plain text - Î™Î”Î™ÎŸ ÎœÎ• admin
            const lines = state.message.split('\n').filter(line => line.trim());
            
            // Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ (Î¼Îµ fallbacks Î³Î¹Î± Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±)
            const fromLine = lines.find(line => line.includes('Î•ÏÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ:')) || 'Î•ÏÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ: -';
            const toLine = lines.find(line => line.includes('Î•ÏÏÏ„Î·ÏƒÎ· Ï€ÏÎ¿Ï‚:')) || 'Î•ÏÏÏ„Î·ÏƒÎ· Ï€ÏÎ¿Ï‚: -';
            const subjectLine = lines.find(line => line.includes('Î˜Î­Î¼Î±:')) || 'Î˜Î­Î¼Î±: -';
            
            // Î¤Î¿ ÎºÏÏÎ¹Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÎµÎ¯Î½Î±Î¹ ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î¼ÎµÏ„Î¬ Ï„Î· Î³ÏÎ±Î¼Î¼Î® Î¸Î­Î¼Î±Ï„Î¿Ï‚
            const subjectIndex = lines.findIndex(line => line.includes('Î˜Î­Î¼Î±:'));
            const questionText = subjectIndex >= 0 && subjectIndex < lines.length - 1 
                ? lines.slice(subjectIndex + 1).join(' ').trim() 
                : 'ÎšÎµÎ¯Î¼ÎµÎ½Î¿ ÎµÏÏÏ„Î·ÏƒÎ·Ï‚';
            
            // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î§Î¡Î©ÎœÎ‘Î¤Î™Î£Î¤ÎŸÎ¥ HTML - Î™Î”Î™ÎŸ ÎœÎ• displayQuestionOnScreen
            const questionHTML = `
                <div class="question-from-line" style="font-size: 2.5vh; color: #3498db; font-weight: bold; margin-bottom: 1vh; text-align: center;">
                    ${fromLine}
                </div>
                <div class="question-to-line" style="font-size: 2.5vh; color: #2ecc71; font-weight: bold; margin-bottom: 1vh; text-align: center;">
                    ${toLine}
                </div>
                <div class="question-subject-line" style="font-size: 3vh; color: #f39c12; font-weight: bold; margin-bottom: 2vh; text-align: center;">
                    ${subjectLine}
                </div>
                <div class="question-text-content" style="font-size: 3.5vh; color: #ffffff; line-height: 1.4; text-align: center;">
                    ${questionText}
                </div>
            `;
            
            // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼Îµ Ï„Î¿ Ï‡ÏÏ‰Î¼Î±Ï„Î¹ÏƒÏ„ÏŒ layout - Î™Î”Î™ÎŸ ÎœÎ• displayQuestionOnScreen
            messageElement.innerHTML = questionHTML;
            
            // Î•Î¹Î´Î¹ÎºÏŒ styling Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ - Î™Î”Î™ÎŸ ÎœÎ• displayQuestionOnScreen
            messageElement.style.textAlign = 'center';
            messageElement.style.lineHeight = '1.5';
            messageElement.style.display = 'flex';
            messageElement.style.flexDirection = 'column';
            messageElement.style.alignItems = 'center';
            
            // Smart font scaling Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚
            adjustQuestionFontSize(messageElement, questionHTML);
            
            
        } else {
            // Î•Î¯Î½Î±Î¹ ÎºÎ±Î½Î¿Î½Î¹ÎºÏŒ Î¼Î®Î½Ï…Î¼Î± - Î Î‘Î›Î™Î‘ Î›ÎŸÎ“Î™ÎšÎ—
            messageElement.textContent = state.message;
            adjustMessageFontSize(messageElement, state.message);
        }
        
        // Adjust timer size
        adjustTimerSize(state.message.trim() !== '' && isMessageVisible);
    }
}
// Î‘Î¦Î‘Î™Î¡Î•Î£Î— Ï„Î¿Ï… else - Î´ÎµÎ½ ÎºÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î¼Î®Î½Ï…Î¼Î± Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î¿ state
    
    // Update message visibility
    if (state.messageVisible !== undefined) {
        isMessageVisible = state.messageVisible;
        const messageElement = document.getElementById('message');
        if (messageElement) {
            messageElement.style.display = isMessageVisible ? 'flex' : 'none';
            
            // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚ timer ÏŒÏ„Î±Î½ Î±Î»Î»Î¬Î¶ÎµÎ¹ Î· Î¿ÏÎ±Ï„ÏŒÏ„Î·Ï„Î±
            const hasVisibleMessage = isMessageVisible && (messageElement.textContent.trim() !== '' || messageElement.innerHTML.trim() !== '');
            adjustTimerSize(hasVisibleMessage);
        }
    }
    
    // Update display settings ÎœÎ•Î¤Î‘ Ï„Î¿Î½ Ï„Î¯Ï„Î»Î¿
    if (state.displaySettings) {
        applyDisplaySettings(state.displaySettings);
    }
    
    // Update sound settings
    if (state.soundSettings) {
        soundEnabled = state.soundSettings.enabled;
        soundVolume = state.soundSettings.volume;
    }
    
    // Start timer if running
    if (isRunning && !timerInterval) {
        startTimer();
    }
    
    // Update vMix settings
    if (state.vmixSettings) {
        if (state.vmixSettings.host) vmixHost = state.vmixSettings.host;
        if (state.vmixSettings.port) vmixPort = state.vmixSettings.port;
        if (state.vmixSettings.enabled !== undefined) {
            vmixEnabled = state.vmixSettings.enabled;
            
            // Î‘Î½ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿, ÎºÏÏÏˆÎµ Î±Î¼Î­ÏƒÏ‰Ï‚ Ï„Î¿ secondary timer
            if (!vmixEnabled) {
                const secondaryTimer = document.getElementById('secondary-timer');
                if (secondaryTimer) {
                    secondaryTimer.style.display = 'none';
                }
            }
        }
    }
    
    // Update clock mode
    if (state.clockMode !== undefined) {
        clockMode = state.clockMode;
        updateTimerDisplay();
    }
    
    // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î¤ÏÏÎ± Î­Ï‡Î¿Ï…Î¼Îµ Ï„Î± ÏƒÏ‰ÏƒÏ„Î¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±
    hasReceivedFullState = true;
    
    // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î¤ÏÏÎ± Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± ÎºÎ¬Î½Î¿Ï…Î¼Îµ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ resize
    const messageElement = document.getElementById('message');
    const hasVisibleMessage = isMessageVisible && messageElement && messageElement.textContent.trim() !== '';
    adjustTimerSize(hasVisibleMessage);
    
    // Update secondary timer Î±Ï€ÏŒ fullState
    if (state.secondaryTimer) {
        updateSecondaryTimer(state.secondaryTimer);
    }

});

// Listen for auto-timer events
socket.on('autoTimerTriggered', (data) => {
    console.log('â±ï¸ Auto-timer triggered event received in timer:', data);
    
    // Could show a brief notification or visual indicator
    // For example, flash the timer border briefly
    const timerElement = document.getElementById('timer');
    if (timerElement) {
        timerElement.style.boxShadow = '0 0 20px #e67e22';
        setTimeout(() => {
            timerElement.style.boxShadow = '';
        }, 2000);
    }
});

socket.on('autoTimerStarted', (data) => {
    console.log('â±ï¸ Auto-timer started event received in timer:', data);
    
    // Optional: Could show a message briefly
    // console.log(`Timer Î¾ÎµÎºÎ¯Î½Î·ÏƒÎµ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î³Î¹Î± ÎµÏÏÏ„Î·ÏƒÎ· (${data.minutes} Î»ÎµÏ€Ï„Î¬)`);
});

socket.on('autoTimerCanceled', (data) => {
    console.log('ğŸš« Auto-timer canceled event received in timer:', data);
    
    // Optional: Visual feedback that auto-timer was canceled
    const timerElement = document.getElementById('timer');
    if (timerElement) {
        timerElement.style.boxShadow = '0 0 20px #95a5a6';
        setTimeout(() => {
            timerElement.style.boxShadow = '';
        }, 1000);
    }
});

            // Listen for secondary timer updates (vMix)
            socket.on('secondaryTimerUpdate', (data) => {
                console.log('ğŸ“¹ Secondary timer update received:', data);
                updateSecondaryTimer(data);
            });
            
            // Listen for vMix settings updates
            socket.on('vmixSettingsUpdate', (data) => {
                console.log('ğŸ“¹ vMix settings update received:', data);
                if (data.host) vmixHost = data.host;
                if (data.port) vmixPort = data.port;
                
                // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î·Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ enabled
                if (data.enabled !== undefined) {
                    vmixEnabled = data.enabled;
                    
                    if (vmixEnabled === false) {
                        const secondaryTimer = document.getElementById('secondary-timer');
                        if (secondaryTimer) {
                            secondaryTimer.style.display = 'none';
                        }
                        console.log('ğŸ”´ vMix secondary timer disabled');
                    } else {
                        console.log('ğŸŸ¢ vMix secondary timer enabled');
                        // Î¤Î¿ secondary timer Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÏŒÏ„Î±Î½ Î­ÏÎ¸Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±
                    }
                }
            });
            
            // Listen for message visibility updates
socket.on('messageVisibilityUpdate', (data) => {
    console.log('Message visibility update received:', data);
    isMessageVisible = data.visible;
    const messageElement = document.getElementById('message');
    if (messageElement) {
        messageElement.style.display = isMessageVisible ? 'flex' : 'none';
        
        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚ timer ÏŒÏ„Î±Î½ Î±Î»Î»Î¬Î¶ÎµÎ¹ Î· Î¿ÏÎ±Ï„ÏŒÏ„Î·Ï„Î±
        const hasVisibleMessage = isMessageVisible && (messageElement.textContent.trim() !== '' || messageElement.innerHTML.trim() !== '');
        adjustTimerSize(hasVisibleMessage);
    }
});

            // Listen for clock mode updates
            socket.on('clockModeUpdate', (data) => {
                console.log('ğŸ• Clock mode update received:', data);
                if (data.clockMode !== undefined) {
                    clockMode = data.clockMode;
                    updateTimerDisplay();
                }
            });
            
            // Listen for flash alert events
            socket.on('flashAlert', (data) => {
                console.log('âš¡ Flash alert received:', data);
                const timerElement = document.getElementById('timer');
                const messageElement = document.getElementById('message');

                if (data.active) {
                    // Start flash animation Î³Î¹Î± timer
                    if (timerElement) timerElement.classList.add('flash-alert');

                    // Start flash animation Î³Î¹Î± message ÎºÎ±Î¹ question elements
                    if (messageElement) {
                        messageElement.classList.add('flash-alert');

                        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Flash Î³Î¹Î± ÏŒÎ»Î± Ï„Î± question elements
                        const questionFromLine = messageElement.querySelector('.question-from-line');
                        const questionToLine = messageElement.querySelector('.question-to-line');
                        const questionSubjectLine = messageElement.querySelector('.question-subject-line');
                        const questionTextContent = messageElement.querySelector('.question-text-content');

                        if (questionFromLine) questionFromLine.classList.add('flash-alert');
                        if (questionToLine) questionToLine.classList.add('flash-alert');
                        if (questionSubjectLine) questionSubjectLine.classList.add('flash-alert');
                        if (questionTextContent) questionTextContent.classList.add('flash-alert');
                    }

                    // Î‘Î½ Î­Ï‡ÎµÎ¹ flashCount (manual flash), ÏƒÏ„Î±Î¼Î¬Ï„Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ X Î±Î½Î±Î²Î¿ÏƒÎ²Î®Î¼Î±Ï„Î±
                    if (data.flashCount) {
                        const flashDuration = data.flashCount * 1200; // 1.2s per flash cycle
                        setTimeout(() => {
                            if (timerElement) timerElement.classList.remove('flash-alert');
                            if (messageElement) {
                                messageElement.classList.remove('flash-alert');

                                // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î£Ï„Î±Î¼Î¬Ï„Î·Î¼Î± flash Î³Î¹Î± ÏŒÎ»Î± Ï„Î± question elements
                                const questionFromLine = messageElement.querySelector('.question-from-line');
                                const questionToLine = messageElement.querySelector('.question-to-line');
                                const questionSubjectLine = messageElement.querySelector('.question-subject-line');
                                const questionTextContent = messageElement.querySelector('.question-text-content');

                                if (questionFromLine) questionFromLine.classList.remove('flash-alert');
                                if (questionToLine) questionToLine.classList.remove('flash-alert');
                                if (questionSubjectLine) questionSubjectLine.classList.remove('flash-alert');
                                if (questionTextContent) questionTextContent.classList.remove('flash-alert');
                            }
                            console.log(`âš¡ Flash stopped after ${data.flashCount} cycles`);
                        }, flashDuration);
                    }
                } else {
                    // Stop flash animation
                    if (timerElement) timerElement.classList.remove('flash-alert');
                    if (messageElement) {
                        messageElement.classList.remove('flash-alert');

                        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î£Ï„Î±Î¼Î¬Ï„Î·Î¼Î± flash Î³Î¹Î± ÏŒÎ»Î± Ï„Î± question elements
                        const questionFromLine = messageElement.querySelector('.question-from-line');
                        const questionToLine = messageElement.querySelector('.question-to-line');
                        const questionSubjectLine = messageElement.querySelector('.question-subject-line');
                        const questionTextContent = messageElement.querySelector('.question-text-content');

                        if (questionFromLine) questionFromLine.classList.remove('flash-alert');
                        if (questionToLine) questionToLine.classList.remove('flash-alert');
                        if (questionSubjectLine) questionSubjectLine.classList.remove('flash-alert');
                        if (questionTextContent) questionTextContent.classList.remove('flash-alert');
                    }

                    // Î‘Î½ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ Ï„ÎµÎ»ÎµÎ¹ÏÏƒÎµÎ¹ (0 Î® Î±ÏÎ½Î·Ï„Î¹ÎºÏŒÏ‚), Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎµ Ï„Î¿Î½ ÎºÏŒÎºÎºÎ¹Î½Î¿ Ï‡ÏÏÎ¼Î±
                    if (timeLeft <= 0) {
                        if (timerElement) timerElement.classList.add('danger');

                        // ÎšÏŒÎºÎºÎ¹Î½Î¿ ÎºÎ±Î¹ Ï„Î¿ progress bar
                        const progressBar = document.querySelector('.progress-bar');
                        if (progressBar) progressBar.classList.add('danger');
                    }
                }
            });

        }

        // Handle incoming commands
        function handleCommand(data) {
           
            
            switch (data.type) {
                case 'timer':
                    switch (data.action) {
                        case 'start':
                            startTimer();
                            break;
                        case 'pause':
                            pauseTimer();
                            break;
                        case 'reset':
                            resetTimer();
                            break;
                    }
                    break;
            }
        }

        // Timer functions
        function startTimer() {
    // Î£Î™Î“ÎŸÎ¥Î¡Î‘ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï€Î±Î»Î¹Î¿Ï interval Ï€ÏÎ¹Î½ Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹ Î½Î­Î¿
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    isRunning = true;
    timerInterval = setInterval(updateTimer, 1000);
}

        function pauseTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
        isRunning = false;
    }
}

        function resetTimer() {
    // Î£Î™Î“ÎŸÎ¥Î¡Î‘ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ interval
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    
    isRunning = false;
    timeLeft = originalTime;
    updateTimerDisplay();
    updateProgressBar();
    
    const timerElement = document.getElementById('timer');
    timerElement.className = 'timer';
}

        function updateTimer() {
    timeLeft--;
    updateTimerDisplay();
    updateProgressBar();
    
    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± Î®Ï‡Î¿Ï…Ï‚ (Î¼ÏŒÎ½Î¿ ÏƒÏ„Î¿ 0, ÏŒÏ‡Î¹ ÏƒÏ„Î¿Î½ Î±ÏÎ½Î·Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿)
    if (timeLeft === warningThreshold) {
        if (soundEnabled) playWarningSound();
    } else if (timeLeft === 0) {
        if (soundEnabled) playEndSound();
        // Î”Î•Î ÏƒÏ„Î±Î¼Î±Ï„Î¬Î¼Îµ Ï„Î¿ timer - ÏƒÏ…Î½ÎµÏ‡Î¯Î¶ÎµÎ¹ ÏƒÏ„Î¿Î½ Î±ÏÎ½Î·Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿
    }
}

        function updateTimerDisplay() {
    const timerElement = document.getElementById('timer');
    
    // Check if clock mode is enabled
    if (clockMode) {
        // Display current time instead of countdown
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();
        
        timerElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        timerElement.className = 'timer'; // Normal styling for clock mode
        
        // Update every second when in clock mode
        if (!timerInterval) {
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }
        
        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î†Î¼ÎµÏƒÎ· Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚
        const messagePreview = document.getElementById('message');
        const hasMessage = messagePreview && messagePreview.textContent.trim() !== '';
        adjustTimerSize(hasMessage && isMessageVisible);
        return;
    }
    
    if (timeLeft < 0) {
        // Î‘ÏÎ½Î·Ï„Î¹ÎºÏŒÏ‚ Ï‡ÏÏŒÎ½Î¿Ï‚ - OVERTIME Î¼Îµ pulsating
        const overtimeSeconds = Math.abs(timeLeft);
        const hours = Math.floor(overtimeSeconds / 3600);
        const minutes = Math.floor((overtimeSeconds % 3600) / 60);
        const seconds = overtimeSeconds % 60;
        
        if (hours > 0) {
            timerElement.textContent = `+${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        } else {
            timerElement.textContent = `+${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Ï„Ï‰Î½ Ï…Ï€Î±ÏÏ‡Î¿Ï…ÏƒÏÎ½ ÎºÎ»Î¬ÏƒÎµÏ‰Î½ ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· overtime
        if (!timerElement.classList.contains('timer')) {
            timerElement.classList.add('timer');
        }
        if (!timerElement.classList.contains('overtime')) {
            timerElement.classList.add('overtime');
        }
        return;
    }
    
    // Î˜ÎµÏ„Î¹ÎºÏŒÏ‚ Ï‡ÏÏŒÎ½Î¿Ï‚ Î® Î¼Î·Î´Î­Î½ - Î±Ï€Î»Î¬ Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î¼Îµ Ï„Î¿Î½ Ï‡ÏÏŒÎ½Î¿ (Î§Î©Î¡Î™Î£ "Î¤Î•Î›ÎŸÎ£ Î§Î¡ÎŸÎÎŸÎ¥")
    const hours = Math.floor(timeLeft / 3600);
    const minutes = Math.floor((timeLeft % 3600) / 60);
    const seconds = Math.max(0, timeLeft % 60);
    
    if (hours > 0) {
        timerElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    } else {
        timerElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
    
    // Apply warning/danger classes - Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· animation classes
    timerElement.classList.remove('warning', 'danger', 'overtime');
    if (!timerElement.classList.contains('timer')) {
        timerElement.classList.add('timer');
    }
    
    if (timeLeft <= warningThreshold && timeLeft > 0) {
        timerElement.classList.add('warning');
    } else if (timeLeft <= 0) {
        // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÎºÏŒÎºÎºÎ¹Î½Î¿Ï… Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚ ÏŒÏ„Î±Î½ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ Ï„ÎµÎ»ÎµÎ¹ÏÏƒÎµÎ¹ Î® ÎµÎ¯Î½Î±Î¹ Î±ÏÎ½Î·Ï„Î¹ÎºÏŒÏ‚
        timerElement.classList.add('danger');
    }
    // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î†Î¼ÎµÏƒÎ· Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î³Î® Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚ Î³Î¹Î± overtime display
    const messagePreview = document.getElementById('message');
    const hasMessage = messagePreview && messagePreview.textContent.trim() !== '';
    adjustTimerSize(hasMessage && isMessageVisible);
}

        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            const percentage = (timeLeft / originalTime) * 100;
            progressBar.style.width = percentage + '%';
            
            // Apply warning/danger classes
            progressBar.className = 'progress-bar';
            
            if (timeLeft <= warningThreshold && timeLeft > 0) {
                progressBar.classList.add('warning');
            } else if (timeLeft === 0) {
                progressBar.classList.add('danger');
            }
        }

        function getTimerStatus() {
            if (timeLeft === 0) return 'danger';
            if (timeLeft <= warningThreshold) return 'warning';
            return 'normal';
        }

        // Handle settings updates
        // Handle settings updates
function handleSettingsUpdate(data) {
    console.log('âš™ï¸ Settings update received in timer:', data);
    
    if (data.timer) {
        if (data.timer.timeLeft !== undefined) timeLeft = data.timer.timeLeft;
        if (data.timer.originalTime !== undefined) originalTime = data.timer.originalTime;
        if (data.timer.warningThreshold !== undefined) warningThreshold = data.timer.warningThreshold;
        
        updateTimerDisplay();
        updateProgressBar();
    }
    
    if (data.display) {
        console.log('ğŸ–¼ï¸ Display settings received:', data.display);
        applyDisplaySettings(data.display);
    }
    
    if (data.sound) {
        if (data.sound.enabled !== undefined) soundEnabled = data.sound.enabled;
        if (data.sound.volume !== undefined) soundVolume = data.sound.volume;
    }
}

        
function applyDisplaySettings(settings) {
    console.log('ğŸ¨ Applying display settings - Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— Î•ÎšÎ”ÎŸÎ£Î—:', settings);
    
    // Î”Î™ÎŸÎ¡Î˜Î©Î£Î—: Î Î¬Î½Ï„Î± ÎµÎ½Î·Î¼ÎµÏÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿Î½ Ï„Î¯Ï„Î»Î¿ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î± settings
    if (settings.title) {
        const titleElement = document.getElementById('title-preview');
        titleElement.textContent = settings.title;
        document.title = settings.title;
        console.log('ğŸ“ Title updated in applyDisplaySettings:', settings.title);
    }
    
    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® titleFontSize Î¼Îµ BOOST Î³Î¹Î± timer
    if (settings.titleFontSize) {
        const titleElement = document.getElementById('title-preview');
        if (titleElement) {
            // BOOST: x1.5 Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ ÏƒÏ„Î¿Î½ timer Î±Ï€ÏŒ Ï„Î¿ admin preview
            const boostedSize = settings.titleFontSize * 1.5;
            titleElement.style.fontSize = boostedSize + 'px';
            console.log('ğŸš€ TitleFontSize BOOSTED in timer:', settings.titleFontSize + 'px â†’ ' + boostedSize + 'px');
        }
    }
    
    // Update background color
    if (settings.backgroundColor) {
        document.body.style.backgroundColor = settings.backgroundColor;
        document.querySelector('.container').style.backgroundColor = settings.backgroundColor;
    }
    
    // Update timer font family
    if (settings.timerFontFamily) {
        const timerElement = document.querySelector('.timer');
        if (timerElement) {
            timerElement.style.fontFamily = settings.timerFontFamily;
            console.log('ğŸ¨ Timer font family updated:', settings.timerFontFamily);
        }
    }
    
    // Update logo
    const positions = ['tl', 'tc', 'tr', 'bl', 'bc', 'br'];
    
    positions.forEach(position => {
        const logoElement = document.getElementById(`logo-${position}`);
        if (logoElement) {
            if (!settings.logoDataUrl || settings.logoDataUrl.trim() === '') {
                logoElement.style.backgroundImage = '';
                logoElement.style.display = 'none';
            } else if (settings.logoPositions && settings.logoPositions[position]) {
                logoElement.style.backgroundImage = `url('${settings.logoDataUrl}')`;
                logoElement.style.display = 'block';
                
                if (settings.logoSize) {
                    const vhSize = (settings.logoSize / 10);
                    logoElement.style.width = vhSize + 'vh';
                    logoElement.style.height = vhSize + 'vh';
                }
            } else {
                logoElement.style.backgroundImage = '';
                logoElement.style.display = 'none';
            }
        }
    });
}
        // Sound functions
        function playWarningSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            gainNode.gain.value = soundVolume;
            oscillator.frequency.value = 440;
            oscillator.type = 'sine';
            
            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function playEndSound() {
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const oscillator3 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            oscillator3.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            gainNode.gain.value = soundVolume;
            
            oscillator1.frequency.value = 440;
            oscillator2.frequency.value = 440;
            oscillator3.frequency.value = 880;
            
            oscillator1.type = 'sine';
            oscillator2.type = 'sine';
            oscillator3.type = 'sine';
            
            oscillator1.start();
            oscillator1.stop(audioContext.currentTime + 0.3);
            
            oscillator2.start(audioContext.currentTime + 0.3);
            oscillator2.stop(audioContext.currentTime + 0.6);
            
            oscillator3.start(audioContext.currentTime + 0.6);
            oscillator3.stop(audioContext.currentTime + 1.2);
        }

      function adjustMessageFontSize(element, text) {
    if (!element) return;
    
    if (!text || text.trim() === '') {
        element.style.fontSize = '';
        element.style.lineHeight = '';
        element.style.maxHeight = '';
        element.style.overflow = '';
        return;
    }
    
    // Portrait detection Î³Î¹Î± 30% Î¼ÎµÎ¯Ï‰ÏƒÎ·
    const isPortrait = window.innerHeight > window.innerWidth;
    const portraitMultiplier = isPortrait ? 0.9 : 1.0;
    
    // Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…
    const words = text.trim().split(/\s+/);
    const wordCount = words.length;
    
    // Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚ Î¿Î¸ÏŒÎ½Î·Ï‚
    const screenHeight = window.innerHeight;
    const screenWidth = window.innerWidth;
    const availableHeight = screenHeight * 0.61; // 60% Î³Î¹Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î±
    const availableWidth = screenWidth * 0.92;   // 90% Ï€Î»Î¬Ï„Î¿Ï‚
    
    // Î•ÎÎ¥Î ÎÎŸÎ£ Î‘Î›Î“ÎŸÎ¡Î™Î˜ÎœÎŸÎ£: Î”Î¿ÎºÎ¹Î¼Î¬Î¶Ï‰ Î¼ÎµÎ³Î­Î¸Î· Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î± Ï€ÏÎ¿Ï‚ Î¼Î¹ÎºÏÎ¬
    let bestFontSize = 2; // Fallback ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î¿
    
    // Î›Î¯ÏƒÏ„Î± Î¼ÎµÎ³ÎµÎ¸ÏÎ½ Î³Î¹Î± Î´Î¿ÎºÎ¹Î¼Î® (Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î± Ï€ÏÎ¿Ï‚ Î¼Î¹ÎºÏÎ¬)
    const testSizes = [25, 20, 16, 14, 12, 10, 8, 6, 5, 4, 3, 2];
    
    for (let testSize of testSizes) {
        // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï€ÏŒÏƒÎ¿ Ï‡ÏÏÎ¿ Î¸Î± ÎºÎ±Ï„Î±Î»Î¬Î¼Î²Î±Î½Îµ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚
        const lineHeight = testSize * 1.1; // vh units
        const estimatedCharWidth = testSize * 0.6; // Î•ÎºÏ„Î¯Î¼Î·ÏƒÎ· Ï€Î»Î¬Ï„Î¿Ï…Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ±
        
        // Î ÏŒÏƒÎ¿Î¹ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Ï‡Ï‰ÏÎ¬Î½Îµ ÏƒÎµ Î¼Î¯Î± Î³ÏÎ±Î¼Î¼Î®;
        const charsPerLine = Math.floor(availableWidth / (estimatedCharWidth * screenHeight / 100));
        
        // Î ÏŒÏƒÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï‡ÏÎµÎ¹Î¬Î¶Î¿Î¼Î±Î¹;
        let neededLines = 1;
        let currentLineLength = 0;
        
        for (let word of words) {
            const wordLength = word.length + 1; // +1 Î³Î¹Î± Ï„Î¿ ÎºÎµÎ½ÏŒ
            
            if (currentLineLength + wordLength > charsPerLine) {
                // Î”ÎµÎ½ Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÏƒÏ„Î· Î³ÏÎ±Î¼Î¼Î®, Ï€Î¬Ï‰ ÏƒÏ„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î·
                neededLines++;
                currentLineLength = wordLength;
            } else {
                currentLineLength += wordLength;
            }
        }
        
        // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¿Ï ÏÏˆÎ¿Ï…Ï‚ Ï€Î¿Ï… Î¸Î± ÎºÎ±Ï„Î±Î»Î¬Î¼Î²Î±Î½Îµ
        const totalHeight = neededLines * lineHeight; // vh units
        
        // Î‘Î½ Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÏƒÏ„Î¿Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï‡ÏÏÎ¿, Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î¼Î­Î³ÎµÎ¸ÏŒÏ‚ Î¼Î±Ï‚!
        if (totalHeight <= (availableHeight / screenHeight * 100)) {
            bestFontSize = testSize;
            console.log(`âœ… Font ${testSize}vh Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÏƒÎµ ${neededLines} Î³ÏÎ±Î¼Î¼Î­Ï‚ (ÏÏˆÎ¿Ï‚: ${totalHeight.toFixed(1)}vh)`);
            break;
        } else {
            console.log(`âŒ Font ${testSize}vh Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ${neededLines} Î³ÏÎ±Î¼Î¼Î­Ï‚ (ÏÏˆÎ¿Ï‚: ${totalHeight.toFixed(1)}vh) - Î´ÎµÎ½ Ï‡Ï‰ÏÎ¬ÎµÎ¹`);
        }
    }
    
    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® portrait multiplier
    const finalSize = bestFontSize * portraitMultiplier;
    
    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® ÏƒÏ„Î¿ element
    element.style.setProperty('font-size', finalSize + 'vh', 'important');
    element.style.setProperty('line-height', '1.1', 'important');
    element.style.setProperty('white-space', 'normal', 'important');
    element.style.setProperty('word-wrap', 'break-word', 'important');
    element.style.setProperty('overflow-wrap', 'break-word', 'important');
    element.style.setProperty('text-align', 'center', 'important');
    
    // Î‘Î¦Î‘Î™Î¡Î•Î£Î— Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ Ï€Î¿Ï… ÎºÏŒÎ²Î¿Ï…Î½ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿
    element.style.setProperty('max-height', 'none', 'important');
    element.style.setProperty('overflow', 'visible', 'important');
    
    console.log(`ğŸ¯ FINAL: "${text}" | ${wordCount} Î»Î­Î¾ÎµÎ¹Ï‚ | ${finalSize.toFixed(1)}vh | Portrait: ${isPortrait ? 'âœ“' : 'âœ—'}`);
}

        

        // Initialize on load
        window.addEventListener('load', () => {
            connectSocket();
            updateTimerDisplay();
            updateProgressBar();
            
            // Fullscreen on double click
            const container = document.querySelector('.container');
            
            container.addEventListener('dblclick', () => {
                if (!document.fullscreenElement) {
                    container.requestFullscreen().catch(err => {
                        console.error('Error entering fullscreen:', err);
                    });
                } else {
                    document.exitFullscreen();
                }
            });
        });

        // Handle visibility change
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && !socket.connected && !isConnecting) {
                // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±Î»Î¹Î¬Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
                if (socket) {
                    socket.disconnect();
                    socket.removeAllListeners();
                }
                connectSocket();
            }
        });
      function adjustTimerSize(hasMessage) {
        if (!hasReceivedFullState) {
        return;
    }
        
    const timerElement = document.getElementById('timer');
    const progressContainer = document.querySelector('.progress-container');
    const mainContent = document.querySelector('.main-content');
    if (!timerElement || !mainContent) return;
    
    
    
    if (hasMessage && isMessageVisible) {
       
        timerElement.style.fontSize = '10vh';
        timerElement.style.margin = '1vh 0';
        timerElement.style.transform = 'none';
        timerElement.style.width = 'auto';
        timerElement.style.position = 'static';
        timerElement.style.left = 'auto';
        timerElement.style.textAlign = 'center';
        if (progressContainer) {
            progressContainer.style.marginTop = '0';
            progressContainer.classList.remove('no-message');
        }
        
        mainContent.style.justifyContent = 'flex-start';
        mainContent.style.paddingTop = '3vh';
        mainContent.style.transform = 'none';
    } else {    
    const screenWidth = window.innerWidth;
    const targetWidth = screenWidth * 0.9;
    
    // Î”Î™ÎŸÎ¡Î˜Î©Î£Î—: Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… Î Î¡Î‘Î“ÎœÎ‘Î¤Î™ÎšÎŸÎ¥ Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚ (Î¼Îµ Ï„Î¿ + Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹)
    const actualTimeString = timerElement.textContent || "00:00";
    const charCount = actualTimeString.length; // Î§ÏÎ®ÏƒÎ· actual length
    
    const estimatedFontSize = (targetWidth / charCount) / 0.6;
    const fontSizeVW = (estimatedFontSize / screenWidth) * 100;
    const finalFontSize = Math.max(12, Math.min(fontSizeVW, 35));
        
        // Î¤Î•Î›Î•Î™ÎŸ CENTERING Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚
        timerElement.style.boxSizing = 'border-box';
        timerElement.style.fontSize = finalFontSize + 'vw';
        timerElement.style.width = '120vw';
        
        timerElement.style.margin = '15vh 0 -40vh 0';
        
        timerElement.style.padding = '0';
        timerElement.style.textAlign = 'center';
        timerElement.style.position = 'relative';
        timerElement.style.transform = 'translateX(0%)';
        timerElement.style.display = 'block';
        
        if (progressContainer) {
            progressContainer.style.marginTop = '40vh';
            progressContainer.classList.add('no-message');
        }
        
        mainContent.style.justifyContent = 'center';
        mainContent.style.paddingTop = '0';
        
    }
    
    // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· warning/danger/overtime classes
    if (timeLeft < 0) {
        timerElement.classList.add('overtime');
    } else if (timeLeft === 0) {
        timerElement.classList.add('danger');
    } else if (timeLeft <= warningThreshold && timeLeft > 0) {
        timerElement.classList.add('warning');
    }
}


// NoSleep Î³Î¹Î± Î½Î± Î¼Î·Î½ ÏƒÎ²Î®Î½ÎµÎ¹ Î· Î¿Î¸ÏŒÎ½Î·
const noSleep = new NoSleep();
let noSleepEnabled = false;

// Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· NoSleep Î¼Îµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ user interaction
function enableNoSleep() {
    if (!noSleepEnabled) {
        try {
            noSleep.enable();
            noSleepEnabled = true;
            console.log('NoSleep ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ');
            
            // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ listeners
            document.removeEventListener('click', enableNoSleep, false);
            document.removeEventListener('touchstart', enableNoSleep, false);
            document.removeEventListener('keydown', enableNoSleep, false);
            
            // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚ ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î·
            showNoSleepStatus();
        } catch (error) {
            console.error('NoSleep failed:', error);
        }
    }
}

// Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· listeners Î³Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ events
document.addEventListener('click', enableNoSleep, false);
document.addEventListener('touchstart', enableNoSleep, false);
document.addEventListener('keydown', enableNoSleep, false);

// Right-click context menu events
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    const contextMenu = document.getElementById('contextMenu');
    contextMenu.style.display = 'block';
    contextMenu.style.left = e.pageX + 'px';
    contextMenu.style.top = e.pageY + 'px';
});

// Hide context menu on click elsewhere
document.addEventListener('click', function(e) {
    const contextMenu = document.getElementById('contextMenu');
    if (!contextMenu.contains(e.target)) {
        contextMenu.style.display = 'none';
    }
});

// Set PC Name handler
document.getElementById('setPcName').addEventListener('click', function() {
    const currentName = localStorage.getItem('pcName') || '';
    const dialog = document.getElementById('pcNameDialog');
    const input = document.getElementById('pcNameInput');
    
    input.value = currentName;
    dialog.style.display = 'flex';
    input.focus();
    input.select();
    
    document.getElementById('contextMenu').style.display = 'none';
});

// PC Name dialog handlers
document.getElementById('pcNameOk').addEventListener('click', function() {
    const input = document.getElementById('pcNameInput');
    const newName = input.value.trim();
    
    if (newName) {
        localStorage.setItem('pcName', newName);
        console.log('âœ… PC Name saved:', newName);
        
        // Î•Ï€Î±Î½Î±ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Î½Î­Î¿ hostname
        if (socket && socket.connected) {
            socket.emit('updateHostname', { hostname: newName });
        }
    }
    
    document.getElementById('pcNameDialog').style.display = 'none';
});

document.getElementById('pcNameCancel').addEventListener('click', function() {
    document.getElementById('pcNameDialog').style.display = 'none';
});

// Enter key support
document.getElementById('pcNameInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        document.getElementById('pcNameOk').click();
    } else if (e.key === 'Escape') {
        document.getElementById('pcNameCancel').click();
    }
});

// Î•Î¹Î´Î¹ÎºÎ® ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î³Î¹Î± iOS
if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
    console.log('iOS device detected - NoSleep will activate on first touch');
    
    // Î ÏÏŒÏƒÎ¸ÎµÏ„Î· Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Î³Î¹Î± iOS
    document.addEventListener('touchend', enableNoSleep, false);
    document.addEventListener('gesturestart', enableNoSleep, false);
}

// Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ NoSleep
function showNoSleepStatus() {
    const statusDiv = document.createElement('div');
    statusDiv.style.cssText = `
        position: fixed;
        top: 5px;
        right: 5px;
        background: rgba(39, 174, 96, 0.9);
        color: white;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 12px;
        z-index: 9999;
        pointer-events: none;
    `;
    statusDiv.textContent = 'ğŸ”‹ Screen Lock Disabled';
    document.body.appendChild(statusDiv);
    
    // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ 3 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
    setTimeout(() => {
        if (statusDiv.parentNode) {
            statusDiv.parentNode.removeChild(statusDiv);
        }
    }, 3000);
}

// ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ NoSleep ÎºÎ¬Î¸Îµ 30 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
// Î‘Ï€Î»Î® Î»ÏÏƒÎ·: Î•Ï€Î±Î½ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· NoSleep ÎºÎ¬Î¸Îµ 1 Î»ÎµÏ€Ï„ÏŒ
setInterval(() => {
    if (noSleepEnabled && noSleep) {
        try {
            // Î•Ï€Î±Î½ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î±Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î± Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
            noSleep.enable();
            console.log('NoSleep reactivated - 1 minute check');
        } catch (error) {
            console.error('NoSleep reactivation failed:', error);
        }
    }
}, 60000); // ÎšÎ¬Î¸Îµ 1 Î»ÎµÏ€Ï„ÏŒ

function displayQuestionOnScreen(question) {
    console.log('ğŸ¯ Displaying question as message:', question);
    
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± HTML-formatted ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… ÎµÏÏÏ„Î·ÏƒÎ·Ï‚ Î§Î©Î¡Î™Î£ container - Ï€Î»Î®ÏÎ·Ï‚ Î¿Î¸ÏŒÎ½Î·
    const questionHTML = `
        <div class="question-from-line" style="font-size: 2.5vh; color: #3498db; font-weight: bold; margin-bottom: 1vh; text-align: center;">
            Î•ÏÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ: ${question.submitter.name} (${question.submitter.company})
        </div>
        <div class="question-to-line" style="font-size: 2.5vh; color: #2ecc71; font-weight: bold; margin-bottom: 1vh; text-align: center;">
            Î•ÏÏÏ„Î·ÏƒÎ· Ï€ÏÎ¿Ï‚: ${question.question.targetSpeaker}
        </div>
        <div class="question-subject-line" style="font-size: 3vh; color: #f39c12; font-weight: bold; margin-bottom: 2vh; text-align: center;">
            Î˜Î­Î¼Î±: ${question.question.subject}
        </div>
        <div class="question-text-content" style="font-size: 3.5vh; color: #ffffff; line-height: 1.4; text-align: center;">
            ${question.question.text}
        </div>
    `;

    // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï„Î·Î½ ÎµÏÏÏ„Î·ÏƒÎ· ÏƒÎ±Î½ Î¼Î®Î½Ï…Î¼Î± ÏƒÏ„Î¿Î½ timer
    const messageElement = document.getElementById('message');
    if (messageElement) {
        messageElement.innerHTML = questionHTML;
        
        // Î•Î¹Î´Î¹ÎºÏŒ styling Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ - Î Î›Î—Î¡Î—Î£ ÎŸÎ˜ÎŸÎÎ—
        messageElement.style.textAlign = 'center';
        messageElement.style.lineHeight = '1.5';
        messageElement.style.display = 'flex';
        messageElement.style.flexDirection = 'column';
        messageElement.style.alignItems = 'center';
        messageElement.style.justifyContent = 'center';
        messageElement.style.width = '100%';
        messageElement.style.height = '100%';
        messageElement.style.padding = '0';
        messageElement.style.margin = '0';

        // Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Responsive font scaling Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚
        adjustQuestionFontSize(messageElement, questionHTML);

        // â† Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Î¯ÎºÏÎ±Î½ÏƒÎ·Ï‚ timer
        const hasMessage = questionHTML && questionHTML.trim() !== '';
        adjustTimerSize(hasMessage && isMessageVisible);
        
        console.log('âœ… Question displayed FULLSCREEN without container');
    }
}
// Hide question from screen (ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚)
function hideQuestionFromScreen() {
    const messageElement = document.getElementById('message');
    if (messageElement) {
        messageElement.textContent = '';
        messageElement.style.textAlign = '';
        messageElement.style.lineHeight = '';
        
        // â† Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—: Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚ timer
        adjustTimerSize(false);
        
        console.log('âœ… Question hidden with timer restored');
    }
}

function adjustQuestionFontSize(messageElement, questionHTML) {
    console.log('ğŸ”§ adjustQuestionFontSize called with WORKING algorithm!');
    
    // Î§Î¡Î—Î£Î— Î¤Î—Î£ Î™Î”Î™Î‘Î£ ÎœÎ•Î˜ÎŸÎ”ÎŸÎ¥ ÎœÎ• Î¤Î‘ MESSAGES - WORKING!
    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¿Ï ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… ÎµÏÏÏ„Î·ÏƒÎ·Ï‚
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = questionHTML;
    const text = tempDiv.textContent || tempDiv.innerText || '';
    
    if (!text || text.trim() === '') {
        return;
    }
    
    console.log(`ğŸ“ Question text: "${text}" (${text.length} chars)`);
    
    // Portrait detection Î³Î¹Î± 10% Î¼ÎµÎ¯Ï‰ÏƒÎ· (Î»Î¹Î³ÏŒÏ„ÎµÏÎ· Î±Ï€ÏŒ messages)
    const isPortrait = window.innerHeight > window.innerWidth;
    const portraitMultiplier = isPortrait ? 0.9 : 1.0;
    
    // Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…
    const words = text.trim().split(/\s+/);
    const wordCount = words.length;
    
    // Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚ Î¿Î¸ÏŒÎ½Î·Ï‚ - Î Î•Î¡Î™Î£Î£ÎŸÎ¤Î•Î¡ÎŸÎ£ Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚
    const screenHeight = window.innerHeight;
    const screenWidth = window.innerWidth;
    const availableHeight = screenHeight * 0.75; // Î‘Î¥ÎÎ—Î£Î—: 75% Î³Î¹Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ (Î±Ï€ÏŒ 61%)
    const availableWidth = screenWidth * 0.95;   // Î‘Î¥ÎÎ—Î£Î—: 95% Ï€Î»Î¬Ï„Î¿Ï‚ (Î±Ï€ÏŒ 92%)
    
    // Î•ÎÎ¥Î ÎÎŸÎ£ Î‘Î›Î“ÎŸÎ¡Î™Î˜ÎœÎŸÎ£: Î”Î¿ÎºÎ¹Î¼Î¬Î¶Ï‰ Î¼ÎµÎ³Î­Î¸Î· Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î± Ï€ÏÎ¿Ï‚ Î¼Î¹ÎºÏÎ¬ - Î™Î”Î™ÎŸ ÎœÎ• MESSAGES
    let bestFontSize = 2; // Fallback ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î¿
    
    // Î›Î¯ÏƒÏ„Î± Î¼ÎµÎ³ÎµÎ¸ÏÎ½ Î³Î¹Î± Î´Î¿ÎºÎ¹Î¼Î® - Î™Î”Î™Î‘ ÎœÎ• MESSAGES
    const testSizes = [25, 20, 16, 14, 12, 10, 8, 6, 5, 4, 3, 2];
    
    for (let testSize of testSizes) {
        // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï€ÏŒÏƒÎ¿ Ï‡ÏÏÎ¿ Î¸Î± ÎºÎ±Ï„Î±Î»Î¬Î¼Î²Î±Î½Îµ - Î™Î”Î™ÎŸÎ£ ÎœÎ• MESSAGES
        const lineHeight = testSize * 1.1; // vh units
        const estimatedCharWidth = testSize * 0.6; // Î•ÎºÏ„Î¯Î¼Î·ÏƒÎ· Ï€Î»Î¬Ï„Î¿Ï…Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ±
        
        // Î ÏŒÏƒÎ¿Î¹ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Ï‡Ï‰ÏÎ¬Î½Îµ ÏƒÎµ Î¼Î¯Î± Î³ÏÎ±Î¼Î¼Î®;
        const charsPerLine = Math.floor(availableWidth / (estimatedCharWidth * screenHeight / 100));
        
        // Î ÏŒÏƒÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï‡ÏÎµÎ¹Î¬Î¶Î¿Î¼Î±Î¹;
        let neededLines = 1;
        let currentLineLength = 0;
        
        for (let word of words) {
            const wordLength = word.length + 1; // +1 Î³Î¹Î± Ï„Î¿ ÎºÎµÎ½ÏŒ
            
            if (currentLineLength + wordLength > charsPerLine) {
                // Î”ÎµÎ½ Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÏƒÏ„Î· Î³ÏÎ±Î¼Î¼Î®, Ï€Î¬Ï‰ ÏƒÏ„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î·
                neededLines++;
                currentLineLength = wordLength;
            } else {
                currentLineLength += wordLength;
            }
        }
        
        // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¿Ï ÏÏˆÎ¿Ï…Ï‚ Ï€Î¿Ï… Î¸Î± ÎºÎ±Ï„Î±Î»Î¬Î¼Î²Î±Î½Îµ
        const totalHeight = neededLines * lineHeight; // vh units
        
        // Î‘Î½ Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÏƒÏ„Î¿Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï‡ÏÏÎ¿, Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î¼Î­Î³ÎµÎ¸ÏŒÏ‚ Î¼Î±Ï‚! (Î¼Îµ safety margin)
        const safetyMargin = 1.1; // 10% ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Ï‡ÏÏÎ¿Ï‚ Î³Î¹Î± Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±
        if (totalHeight * safetyMargin <= (availableHeight / screenHeight * 100)) {
            bestFontSize = testSize;
            console.log(`âœ… Font ${testSize}vh Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÏƒÎµ ${neededLines} Î³ÏÎ±Î¼Î¼Î­Ï‚ (ÏÏˆÎ¿Ï‚: ${totalHeight.toFixed(1)}vh + safety, Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿: ${(availableHeight/screenHeight*100).toFixed(1)}vh)`);
            break;
        } else {
            console.log(`âŒ Font ${testSize}vh Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ${neededLines} Î³ÏÎ±Î¼Î¼Î­Ï‚ (ÏÏˆÎ¿Ï‚: ${totalHeight.toFixed(1)}vh + safety) - Î´ÎµÎ½ Ï‡Ï‰ÏÎ¬ÎµÎ¹`);
        }
    }
    
    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® portrait multiplier
    const finalSize = bestFontSize * portraitMultiplier;
    
    // Î•Î¦Î‘Î¡ÎœÎŸÎ“Î— Î£Î¤Î™Î£ Î•Î¡Î©Î¤Î—Î£Î•Î™Î£ - Î±Î½Î±Î»Î¿Î³Î¹ÎºÎ¬ Î¼ÎµÎ³Î­Î¸Î·
    const fromSize = finalSize * 0.7;     // ÎœÎ¹ÎºÏÏŒÏ„ÎµÏÎ¿ Î³Î¹Î± "Î‘Ï€ÏŒ"
    const toSize = finalSize * 0.7;       // ÎœÎ¹ÎºÏÏŒÏ„ÎµÏÎ¿ Î³Î¹Î± "Î ÏÎ¿Ï‚"
    const subjectSize = finalSize * 0.85;  // ÎœÎµÏƒÎ±Î¯Î¿ Î³Î¹Î± "Î˜Î­Î¼Î±"
    const textSize = finalSize;            // ÎœÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ Î³Î¹Î± ÎºÏÏÎ¹Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿
    
    // Î•Î Î™Î Î›Î•ÎŸÎ: Î•Î¾Î±ÏƒÏ†Î¬Î»Î¹ÏƒÎ· ÏŒÏ„Î¹ Ï„Î¿ message container Î´ÎµÎ½ ÎºÏŒÎ²ÎµÎ¹
    messageElement.style.setProperty('max-height', 'none', 'important');
    messageElement.style.setProperty('overflow', 'visible', 'important');
    messageElement.style.setProperty('height', 'auto', 'important');
    
    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® Ï„Ï‰Î½ Î½Î­Ï‰Î½ Î¼ÎµÎ³ÎµÎ¸ÏÎ½ Î¼Îµ !important - Î™Î”Î™ÎŸ ÎœÎ• MESSAGES
    const fromLine = messageElement.querySelector('.question-from-line');
    const toLine = messageElement.querySelector('.question-to-line');
    const subjectLine = messageElement.querySelector('.question-subject-line');
    const textContent = messageElement.querySelector('.question-text-content');
    
    if (fromLine) {
        fromLine.style.setProperty('font-size', fromSize + 'vh', 'important');
        fromLine.style.setProperty('line-height', '1.1', 'important');
        fromLine.style.setProperty('max-height', 'none', 'important');
        fromLine.style.setProperty('overflow', 'visible', 'important');
    }
    if (toLine) {
        toLine.style.setProperty('font-size', toSize + 'vh', 'important');
        toLine.style.setProperty('line-height', '1.1', 'important');
        toLine.style.setProperty('max-height', 'none', 'important');
        toLine.style.setProperty('overflow', 'visible', 'important');
    }
    if (subjectLine) {
        subjectLine.style.setProperty('font-size', subjectSize + 'vh', 'important');
        subjectLine.style.setProperty('line-height', '1.1', 'important');
        subjectLine.style.setProperty('max-height', 'none', 'important');
        subjectLine.style.setProperty('overflow', 'visible', 'important');
    }
    if (textContent) {
        textContent.style.setProperty('font-size', textSize + 'vh', 'important');
        textContent.style.setProperty('line-height', '1.1', 'important');
        textContent.style.setProperty('max-height', 'none', 'important');
        textContent.style.setProperty('overflow', 'visible', 'important');
    }
    
    console.log(`ğŸ¯ WORKING algorithm applied: Î±Ï€ÏŒ=${fromSize.toFixed(1)}vh, Ï€ÏÎ¿Ï‚=${toSize.toFixed(1)}vh, Î¸Î­Î¼Î±=${subjectSize.toFixed(1)}vh, ÎºÎµÎ¯Î¼ÎµÎ½Î¿=${textSize.toFixed(1)}vh`);
}

// ========== SECONDARY TIMER FUNCTIONS (vMix Integration) ==========
let vmixHost = '192.168.5.123';
let vmixPort = '8088';
let vmixEnabled = true;

function updateSecondaryTimer(data) {
    const secondaryTimer = document.getElementById('secondary-timer');
    const titleElement = document.getElementById('secondary-timer-title');
    const timeElement = document.getElementById('secondary-timer-time');
    const progressElement = document.getElementById('secondary-progress-bar');
    
    // Î‘Î½ Ï„Î¿ vMix secondary timer ÎµÎ¯Î½Î±Î¹ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿, Î¼Î·Î½ ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÎ¹Ï‚ Ï„Î¯Ï€Î¿Ï„Î±
    if (!vmixEnabled) {
        secondaryTimer.style.display = 'none';
        return;
    }
    
    if (!data || !data.active || data.remaining <= 0) {
        // Slide out animation ÏŒÏ„Î±Î½ Ï„ÎµÎ»ÎµÎ¹ÏÎ½ÎµÎ¹ Ï„Î¿ video
        if (secondaryTimer.style.display === 'block') {
            secondaryTimer.classList.add('slide-out');
            
            // ÎšÏÏÏˆÎ¹Î¼Î¿ Î¼ÎµÏ„Î¬ Ï„Î¿ animation (800ms)
            setTimeout(() => {
                secondaryTimer.style.display = 'none';
                secondaryTimer.classList.remove('slide-out');
            }, 800);
        }
        return;
    }
    
    // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· secondary timer
    secondaryTimer.style.display = 'block';
    secondaryTimer.classList.remove('slide-out');
    
    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¯Ï„Î»Î¿Ï…
    titleElement.textContent = `ğŸ¬ ${data.title}`;
    
    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï‡ÏÏŒÎ½Î¿Ï… (remaining)
    const minutes = Math.floor(data.remaining / 60);
    const seconds = data.remaining % 60;
    timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· progress bar
    const progressPercent = data.total > 0 ? ((data.total - data.remaining) / data.total) * 100 : 0;
    progressElement.style.width = `${Math.min(100, Math.max(0, progressPercent))}%`;
    
    // Î›Î¿Î³Î¹ÎºÎ® Ï‡ÏÏ‰Î¼Î¬Ï„Ï‰Î½ progress bar Î²Î¬ÏƒÎµÎ¹ Ï…Ï€Î¿Î»ÎµÎ¹Ï€ÏŒÎ¼ÎµÎ½Î¿Ï… Ï‡ÏÏŒÎ½Î¿Ï…
    const remainingPercent = data.total > 0 ? (data.remaining / data.total) * 100 : 0;
    
    // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ classes
    progressElement.classList.remove('warning', 'danger');
    
    if (remainingPercent <= 10) {
        // ÎšÏŒÎºÎºÎ¹Î½Î¿ - 10% Î® Î»Î¹Î³ÏŒÏ„ÎµÏÎ¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Î±Ï€Î¿Î¼Î­Î½ÎµÎ¹
        progressElement.classList.add('danger');
    } else if (remainingPercent <= 25) {
        // Î Î¿ÏÏ„Î¿ÎºÎ±Î»Î¯ - 25% Î® Î»Î¹Î³ÏŒÏ„ÎµÏÎ¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Î±Ï€Î¿Î¼Î­Î½ÎµÎ¹
        progressElement.classList.add('warning');
    }
    // Î‘Î»Î»Î¹ÏÏ‚ Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ (default)
    
    console.log(`ğŸ“¹ Secondary timer updated: ${data.title} - ${minutes}:${seconds.toString().padStart(2, '0')} remaining (${remainingPercent.toFixed(1)}% left)`);
}


// Format time Î³Î¹Î± secondary timer
function formatSecondaryTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

    </script>
</body>
</html>