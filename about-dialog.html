<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Σχετικά με το TimeCast™ Pro</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1E2B36, #2C3E50);
            color: #F2F0EB;
            overflow: hidden;
            user-select: none;
        }

        .dialog-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: rgba(242, 240, 235, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            border: 2px solid #F2F0EB;
        }

        .title {
            font-size: 24px;
            font-weight: 300;
            margin: 0;
            letter-spacing: 1px;
        }

        .version {
            font-size: 16px;
            opacity: 0.8;
            margin: 5px 0;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: rgba(242, 240, 235, 0.05);
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(242, 240, 235, 0.1);
        }

        .content h3 {
            color: #F2F0EB;
            font-size: 16px;
            margin: 15px 0 8px 0;
            font-weight: 400;
        }

        .content ul {
            margin: 0 0 15px 0;
            padding-left: 20px;
        }

        .content li {
            margin: 5px 0;
            font-size: 14px;
            line-height: 1.4;
        }

        .legal-info {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 13px;
            line-height: 1.4;
        }

        .copyright {
            text-align: center;
            font-size: 13px;
            opacity: 0.7;
            margin: 15px 0;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(242, 240, 235, 0.1);
            color: #F2F0EB;
            border: 1px solid rgba(242, 240, 235, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(242, 240, 235, 0.2);
            transform: translateY(-1px);
        }

        /* Scrollbar styling */
        .content::-webkit-scrollbar {
            width: 8px;
        }

        .content::-webkit-scrollbar-track {
            background: rgba(242, 240, 235, 0.1);
            border-radius: 4px;
        }

        .content::-webkit-scrollbar-thumb {
            background: rgba(242, 240, 235, 0.3);
            border-radius: 4px;
        }

        .content::-webkit-scrollbar-thumb:hover {
            background: rgba(242, 240, 235, 0.5);
        }

        /* License status styling */
        .license-status {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.4;
        }

        .license-status.unlicensed {
            background: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
        }

        .license-status.trial {
            background: rgba(255, 193, 7, 0.1);
            border-color: rgba(255, 193, 7, 0.3);
        }

        .license-key {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .license-details {
            margin-top: 8px;
            font-size: 13px;
            opacity: 0.9;
        }

        .btn-license {
            background: #27ae60;
            color: white;
            margin-left: 10px;
        }

        .btn-license:hover {
            background: #229954;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="dialog-container">
        <div class="header">
            <div class="logo">⏱️</div>
            <h1 class="title">TimeCast™ Pro</h1>
            <div class="version" id="version">v6.7.10</div>
        </div>

        <div class="content">
            <!-- License Status Section -->
            <div id="licenseStatus" class="license-status unlicensed">
                <strong>🔐 License Status:</strong> <span id="licenseStatusText">Checking...</span><br>
                <span id="licenseKey" class="license-key" style="display: none;"></span>
                <div id="licenseDetails" class="license-details" style="display: none;"></div>
            </div>

            <h3>🎯 Professional Conference Timer System</h3>
            
            <h3>🔧 Χαρακτηριστικά:</h3>
            <ul>
                <li>Χρονόμετρο αντίστροφης μέτρησης σε πραγματικό χρόνο</li>
                <li>Συγχρονισμός πολλαπλών συσκευών προβολής</li>
                <li>Υποστήριξη δεύτερης οθόνης HDMI/DisplayPort</li>
                <li>Διαχείριση χρονοδιαγράμματος εκδηλώσεων</li>
                <li>Ενσωματωμένο σύστημα ερωτήσεων Q&A</li>
                <li>Google Sheets integration για event planning</li>
                <li>vMix professional integration</li>
                <li>Excel/PDF εξαγωγή αναφορών</li>
                <li>Clock mode για προβολή τρέχουσας ώρας</li>
                <li>Auto-timer system για ερωτήσεις</li>
                <li>Έξυπνο AI company name normalization</li>
            </ul>

            <div class="legal-info">
                <strong>™️ ΝΟΜΙΚΕΣ ΠΛΗΡΟΦΟΡΙΕΣ:</strong><br>
                TimeCast™ είναι εμπορικό σήμα (trademark) της Sovereign Event Systems.<br>
                Το σύμβολο ™ υποδηλώνει unregistered trademark rights.
            </div>

            <div class="copyright">
                🏢 © 2025 Sovereign Event Systems. Όλα τα δικαιώματα διατηρούνται.<br>
                📅 Build: <span id="buildDate"></span>
            </div>
        </div>

        <div class="buttons">
            <button class="btn btn-secondary" onclick="closeDialog()">Κλείσιμο</button>
            <button class="btn btn-license" id="manageLicenseBtn" onclick="manageLicense()" style="display: none;">Manage License</button>
            <button class="btn btn-primary" onclick="openWebsite()">Επίσκεψη Website</button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const i18next = require('i18next');
        const Backend = require('i18next-fs-backend');
        const path = require('path');
        const fs = require('fs');

        // Initialize i18next
        async function initI18next() {
            try {
                // Load saved language preference
                let savedLanguage = 'el';
                try {
                    const configPath = path.join(__dirname, 'language-config.json');
                    if (fs.existsSync(configPath)) {
                        const config = JSON.parse(fs.readFileSync(configPath, 'utf8'));
                        savedLanguage = config.language || 'el';
                    }
                } catch (e) {
                    console.log('No saved language config found, using default: el');
                }

                await i18next.use(Backend).init({
                    lng: savedLanguage,
                    fallbackLng: 'el',
                    supportedLngs: ['el', 'en'],
                    ns: ['admin'],
                    defaultNS: 'admin',
                    backend: {
                        loadPath: path.join(__dirname, 'locales', '{{lng}}', '{{ns}}.json')
                    }
                });

                console.log('✅ i18next initialized in about-dialog - Language:', i18next.language);
                updateDialogTexts();
            } catch (error) {
                console.error('❌ i18next initialization failed:', error);
            }
        }

        // Update all dialog texts
        function updateDialogTexts() {
            document.title = i18next.t('aboutDialog.title');
            document.querySelector('.content h3:first-child').textContent = i18next.t('aboutDialog.subtitle');
            document.querySelector('.content h3:nth-child(2)').textContent = i18next.t('aboutDialog.featuresTitle');
            
            // Update features list
            const featuresList = document.querySelector('.content ul');
            const features = i18next.t('aboutDialog.features', { returnObjects: true });
            featuresList.innerHTML = features.map(feature => `<li>${feature}</li>`).join('');
            
            // Update legal info
            document.querySelector('.legal-info strong').innerHTML = i18next.t('aboutDialog.legalTitle');
            document.querySelector('.legal-info').innerHTML = 
                `<strong>${i18next.t('aboutDialog.legalTitle')}</strong><br>${i18next.t('aboutDialog.legalText')}`;
            
            // Update buttons
            document.querySelector('.btn-secondary').textContent = i18next.t('aboutDialog.buttonClose');
            document.querySelector('.btn-primary').textContent = i18next.t('aboutDialog.buttonWebsite');
            
            // Update copyright (keeping the build date span)
            const buildDateSpan = document.getElementById('buildDate');
            const buildDate = buildDateSpan.textContent;
            document.querySelector('.copyright').innerHTML = 
                `${i18next.t('aboutDialog.copyright')} <span id="buildDate">${buildDate}</span>`;
        }
        
        // Update version, build date, and license status
        document.addEventListener('DOMContentLoaded', async () => {
            await initI18next();
            
            try {
                const version = await ipcRenderer.invoke('get-app-version');
                document.getElementById('version').textContent = `v${version}`;
                
                const currentLang = i18next.language || 'el';
                const locale = currentLang === 'en' ? 'en-US' : 'el-GR';
                document.getElementById('buildDate').textContent = new Date().toLocaleDateString(locale);
                
                // Load license status with timeout fallback
                const licenseStatusPromise = loadLicenseStatus();
                const timeoutPromise = new Promise((resolve) => {
                    setTimeout(() => {
                        console.warn('⏱️ License status check timeout - using fallback');
                        document.getElementById('licenseStatusText').textContent = 'License status unavailable';
                        resolve();
                    }, 3000); // 3 second timeout
                });

                await Promise.race([licenseStatusPromise, timeoutPromise]);

            } catch (error) {
                console.error('Error loading version info:', error);
            }
        });

        // Load and display complete app status (license + trial)
        async function loadLicenseStatus() {
            try {
                console.log('🔍 About Dialog: Loading license status...');
                const { ipcRenderer } = require('electron');
                const appStatus = await ipcRenderer.invoke('getCompleteAppStatus');
                console.log('📦 About Dialog: Received app status:', appStatus);

                const statusDiv = document.getElementById('licenseStatus');
                const statusText = document.getElementById('licenseStatusText');
                const licenseKey = document.getElementById('licenseKey');
                const licenseDetails = document.getElementById('licenseDetails');
                const manageLicenseBtn = document.getElementById('manageLicenseBtn');

                // Ensure we have valid data
                if (!appStatus || typeof appStatus !== 'object') {
                    console.error('❌ Invalid app status received:', appStatus);
                    statusText.textContent = 'Unable to retrieve license status';
                    return;
                }

                // Update status text with the displayText from our new handler
                statusText.textContent = appStatus.displayText || 'Status Unknown';
                console.log('✅ Status text updated to:', statusText.textContent);

                // Show detailed status if available
                if (appStatus.detailedStatus) {
                    licenseDetails.innerHTML = appStatus.detailedStatus;
                    licenseDetails.style.display = 'block';
                } else if (appStatus.trialStatus && appStatus.trialStatus.timeRemaining) {
                    // Fallback for trial status
                    const details = [];
                    if (appStatus.phase === 'trial') {
                        const daysLeft = Math.ceil(appStatus.trialStatus.timeRemaining / (24 * 60 * 60 * 1000));
                        details.push(`Time remaining: ${daysLeft} days`);
                    } else if (appStatus.phase === 'grace') {
                        const minutesLeft = Math.ceil(appStatus.trialStatus.timeRemaining / (60 * 1000));
                        details.push(`Time remaining: ${minutesLeft} minutes`);
                    }

                    if (details.length > 0) {
                        licenseDetails.innerHTML = details.join('<br>');
                        licenseDetails.style.display = 'block';
                    }
                }

                // Set appropriate CSS class based on phase
                let cssClass = 'license-status';
                if (appStatus.phase === 'active') {
                    cssClass = 'license-status'; // Green for active license
                } else if (appStatus.phase === 'trial') {
                    cssClass = 'license-status trial'; // Yellow for trial
                } else if (appStatus.phase === 'grace') {
                    cssClass = 'license-status trial'; // Yellow for grace period
                } else {
                    cssClass = 'license-status unlicensed'; // Red for unlicensed/expired
                }
                statusDiv.className = cssClass;

                // Show license key for active licenses
                if (appStatus.phase === 'active' && appStatus.license?.license?.key) {
                    licenseKey.textContent = appStatus.license.license.key;
                    licenseKey.style.display = 'block';
                }

                // Show Manage License button for non-active states
                if (appStatus.phase !== 'active') {
                    manageLicenseBtn.textContent = 'Activate License';
                    manageLicenseBtn.style.display = 'inline-block';
                }

                // Show error details if present
                if (appStatus.error) {
                    if (!appStatus.detailedStatus) {
                        licenseDetails.innerHTML = appStatus.error;
                        licenseDetails.style.display = 'block';
                    }
                }

            } catch (error) {
                console.error('Error loading app status:', error);
                document.getElementById('licenseStatusText').textContent = 'Unable to check app status';
            }
        }

        function closeDialog() {
            ipcRenderer.send('close-about-dialog');
        }

        function openWebsite() {
            ipcRenderer.send('open-website', 'https://www.sovereign.gr');
            closeDialog();
        }

        function manageLicense() {
            // Close About dialog first
            closeDialog();

            // Use a simple message to open settings via main window's eval
            ipcRenderer.send('eval-main-window', 'openSettings(); setTimeout(() => { const licensingSection = document.getElementById(\'license-management-section\'); if (licensingSection) { licensingSection.scrollIntoView({ behavior: \'smooth\', block: \'start\' }); } }, 300);');
        }

        // ESC key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeDialog();
            }
        });
    </script>
</body>
</html>