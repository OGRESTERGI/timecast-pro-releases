# TimeCastÂ® Pro - Complete Trial & Licensing System Documentation

## Î£ÎºÎ¿Ï€ÏŒÏ‚ Î–Ï‰Î®Ï‚: ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î‘Î´ÎµÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Î¼Îµ Real-time UI Updates

**Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±**: 2025-09-27
**Status**: âœ… **Production Ready** - Complete license amnesia ÎºÎ±Î¹ grace period system implemented

**DISTRIBUTION METHOD**: Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î´Î¹Î±Î½Î­Î¼ÎµÏ„Î±Î¹ ÏƒÎµ .exe Î±ÏÏ‡ÎµÎ¯Î¿ Ï€Î±ÏÎ±Î³ÏŒÎ¼ÎµÎ½Î¿ Î¼Îµ `npm run build` (Electron Builder).

---

## ğŸ¯ ÎšÎ¡Î™Î£Î™ÎœÎŸÎ£ ÎœÎ—Î§Î‘ÎÎ™Î£ÎœÎŸÎ£ - Complete Lifecycle

### 1. Î ÏÏÏ„Î· Î•ÎºÎºÎ¯Î½Î·ÏƒÎ· Î•Ï†Î±ÏÎ¼Î¿Î³Î®Ï‚ (Trial Period)

**Î£ÎµÎ½Î¬ÏÎ¹Î¿**: PC1 Î±Î½Î¿Î¯Î³ÎµÎ¹ Î³Î¹Î± 1Î· Ï†Î¿ÏÎ¬ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®
- **Î”Î¹ÎºÎ±Î¯Ï‰Î¼Î±**: ÎœÏŒÎ½Î¿ Î¼Î¹Î± Ï†Î¿ÏÎ¬ ÏƒÎµ ÎºÎ¬Î¸Îµ machine PC Î¼Î¹Î± Ï€ÎµÏÎ¯Î¿Î´Î¿Ï‚ **trial 10 Î·Î¼ÎµÏÏÎ½** (1 Î»ÎµÏ€Ï„ÏŒ Î³Î¹Î± Î´Î¿ÎºÎ¹Î¼Î­Ï‚)
- **Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ·**: Î’Î¬ÏƒÎµÎ¹ machine fingerprint (e.g., `TC-FBD45C54-416A286B`)
- **Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·**: Machine ID ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ real-time ÏƒÏ„Î¿ online TimeCast server

**Trial Phase Flow**:
```
[Î ÏÏÏ„Î· ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·] â†’ [Trial 10 Î·Î¼Î­ÏÎµÏ‚] â†’ [License key ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® OR Grace period]
```

### 2. Trial Period Î•Î¾Î¬Î½Ï„Î»Î·ÏƒÎ·

**Î‘Î½ Î”Î•Î ÎµÎ¹ÏƒÎ±Ï‡Î¸ÎµÎ¯ license key Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ trial period**:
- **Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ·**: Grace mode **5 Î»ÎµÏ€Ï„ÏÎ½**
- **ÎœÎµÏ„Î¬ Î±Ï€ÏŒ 5 Î»ÎµÏ€Ï„Î¬**: Î¤ÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚
- **UI Behavior**: Real-time countdown Î¼Îµ Grace Period dialog

### 3. License Key Activation (Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚)

**Î‘Î½ ÎµÎ¹ÏƒÎ±Ï‡Î¸ÎµÎ¯ Î­Î³ÎºÏ…ÏÎ¿ license key**:
- **Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·**: License key Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹ local ÎºÎ±Î¹ online server
- **ÎœÎ½Î®Î¼Î·**: Î˜Ï…Î¼Î¬Ï„Î±Î¹ Ï„Î¿ license key ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Î¾ÎµÎºÎ¹Î½Î¬ Î· ÎµÏ†Î±ÏÎ¼Î¿Î³Î®
- **Machine Binding**: Î¤Î¿ machine ID ÏƒÏ…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿ license key ÏƒÏ„Î¿Î½ server
- **Status**: ÎœÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÎµ "Active License" mode

---

## ğŸ”„ DEACTIVATION CYCLE - Complete License Amnesia

### Local Deactivation (Î‘Ï€ÏŒ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚)

**User Action**: Î Î±Ï„Î¬ÎµÎ¹ "Deactivate Machine" Î¼Î­ÏƒÎ± Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®
1. **Î†Î¼ÎµÏƒÎ· Î´Î¹Î±Î³ÏÎ±Ï†Î®**: License key Î´Î¹Î±Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ Î‘ÎœÎ•Î£Î‘ Î±Ï€ÏŒ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¸Î­ÏƒÎµÎ¹Ï‚ Î¼Î½Î®Î¼Î·Ï‚
2. **Complete Amnesia**: ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î±Ï€ÏŒ localStorage, sessionStorage, cache files, global variables
3. **Server Update**: Machine deactivation ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ ÏƒÏ„Î¿Î½ online server
4. **Grace Period**: Î•Î¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î· ÏƒÎµ grace period 5 Î»ÎµÏ€Ï„ÏÎ½
5. **UI Dialog**: Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Grace Period dialog Î¼Îµ countdown

### Remote Deactivation (Î‘Ï€ÏŒ admin.php)

**Admin Action**: Î Î±Ï„Î¬ÎµÎ¹ "Deactivate Machine" Î±Ï€ÏŒ Ï„Î¿ online admin panel
1. **Server-side deactivation**: Machine status Î±Î»Î»Î¬Î¶ÎµÎ¹ ÏƒÏ„Î¿Î½ server
2. **Real-time detection**: Î•Ï†Î±ÏÎ¼Î¿Î³Î® ÎµÎ½Ï„Î¿Ï€Î¯Î¶ÎµÎ¹ Ï„Î·Î½ Î±Î»Î»Î±Î³Î® ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· validation
3. **Complete Amnesia**: ÎŠÎ´Î¹Î± Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Î¼Îµ local deactivation
4. **Forced Grace Dialog**: **FORCE show** Grace Period dialog (ignore showGracePeriodDialog flag)
5. **Consistent UX**: ÎŠÎ´Î¹Î± ÎµÎ¼Ï€ÎµÎ¹ÏÎ¯Î± Î¼Îµ manual deactivation

### Offline Grace Period (7 Days)

**Scenario**: Î•Ï†Î±ÏÎ¼Î¿Î³Î® Î¼Îµ ÎµÎ½ÎµÏÎ³ÏŒ license Ï‡Î¬Î½ÎµÎ¹ internet connectivity
1. **Detection**: Î•Ï†Î±ÏÎ¼Î¿Î³Î® ÎµÎ½Ï„Î¿Ï€Î¯Î¶ÎµÎ¹ Ï„Î·Î½ Î­Î»Î»ÎµÎ¹ÏˆÎ· internet ÎºÎ±Ï„Î¬ Ï„Î·Î½ validation
2. **Offline Mode**: ÎœÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÎµ offline grace period **7 Î·Î¼ÎµÏÏÎ½**
3. **Local Cache**: Î§ÏÎ®ÏƒÎ· cached license data Î³Î¹Î± validation
4. **UI Status**: Title bar Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ "TimeCast Pro - Offline Mode (X days remaining)"
5. **Forced Reconnection**: ÎœÎµÏ„Î¬ Ï„Î¹Ï‚ 7 Î·Î¼Î­ÏÎµÏ‚, Î¥Î ÎŸÎ§Î¡Î•Î©Î¤Î™ÎšÎ— online validation
6. **Expiration**: Î‘Î½ Î´ÎµÎ½ ÎµÏ€Î±Î½Î­Î»Î¸ÎµÎ¹ internet, Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÎµ Grace Period 5 Î»ÎµÏ€Ï„ÏÎ½

**Technical Behavior**:
- **License remains valid** Î³Î¹Î± 7 Î·Î¼Î­ÏÎµÏ‚ Ï‡Ï‰ÏÎ¯Ï‚ internet
- **Countdown display** ÏƒÏ„Î¿ title bar
- **Automatic retry** Î³Î¹Î± internet connection ÎºÎ¬Î¸Îµ Î»ÎµÏ€Ï„ÏŒ
- **Graceful degradation** - Ï€Î»Î®ÏÎ·Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Î´Î¹Î±Ï„Î·ÏÎµÎ¯Ï„Î±Î¹

---

## ğŸ”’ MACHINE CONFLICT DETECTION - 1-License-Per-Machine Policy

### Scenario: Î”ÎµÏÏ„ÎµÏÎ¿ PC Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ activation

**User Action**: Î ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÏƒÎµ Î¬Î»Î»Î¿ PC Î¼Îµ Ï„Î¿ Î¯Î´Î¹Î¿ license key

**Server Query Process**:
1. **Online Check**: "Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î®Î´Î· Î±Ï…Ï„ÏŒ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯;"
2. **Server Response**:
   - **"ÎÎ‘Î™"** â†’ Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ· Î¼Îµ Î¼Î®Î½Ï…Î¼Î±: *"This license key is already activated on another machine {MACHINE-NAME}. Please deactivate the other machine first in order to use the license "TC-2025-154DDA6C" in this pc"*
   - **"ÎŸÎ§Î™"** â†’ Î ÏÎ¿Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬ Î· ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·

**Machine Name Display**: Î•Î¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… PC Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ license

---

## ğŸ§¹ COMPLETE LICENSE AMNESIA SYSTEM

### Multi-Layer Clearing Implementation

**Technical Stack** (`license-manager.js:clearAllLicenseData()`):
```javascript
clearAllLicenseData() {
    try {
        console.log('ğŸ§¹ğŸ§¹ COMPLETE LICENSE AMNESIA - Clearing ALL license data...');

        // Layer 1: File-based cache
        this.clearLicenseFromMemory();

        // Layer 2: Browser storage
        if (typeof window !== 'undefined' && window.localStorage) {
            localStorage.removeItem('timecast_license_key');
            localStorage.removeItem('license_cache');
            localStorage.removeItem('licenseData');
        }

        // Layer 3: Session storage
        if (window.sessionStorage) {
            sessionStorage.clear();
        }

        // Layer 4: Global variables
        if (window.currentLicenseData) delete window.currentLicenseData;
        if (window.licenseKey) delete window.licenseKey;

        // Layer 5: UI input fields (via IPC)
        // Executed from main process to renderer

    } catch (error) {
        console.error('âŒ Error in complete license clearing:', error);
    }
}
```

### File Locations Î³Î¹Î± Complete Clearing

**Cache Files**:
- `C:\Users\[user]\AppData\Roaming\sovereign-event-timer\.license_cache.json`
- `C:\Users\[user]\AppData\Roaming\sovereign-event-timer\timer-auto-save.json`

**Memory Locations**:
- `localStorage.timecast_license_key`
- `sessionStorage` (complete clear)
- `window.currentLicenseData`
- `window.licenseKey`
- UI input fields (license key input box)

---

## âš¡ REAL-TIME UI UPDATES & SERVER MONITORING

### Server-side Monitoring (`main.js`)

**License Validation Monitor**:
```javascript
// Real-time license validation every 30 seconds
setInterval(async () => {
    const currentStatus = await licenseManager.validateLicense();

    if (currentStatus.phase === 'deactivated') {
        // Execute complete license amnesia
        await licenseManager.clearAllLicenseData();

        // Force Grace Period mode
        startTrialCountdown(trialStatus);
        showGracePeriodDialog(trialStatus);
    }
}, 30000);
```

**IPC Communication**:
- **Main Process** â†’ **Renderer Process**: License status updates
- **Renderer Process** â†’ **Main Process**: UI state changes
- **Bi-directional sync**: Timer settings, license data, grace period status

### Client-side Real-time Updates

**Socket Events**:
- `licenseStatusUpdate`: License activation/deactivation changes
- `trialStatusUpdate`: Trial period countdown updates
- `gracePeriodUpdate`: Grace period countdown Î¼Îµ force dialog display

---

## ğŸ”§ CRITICAL BUG FIXES & LESSONS LEARNED

### 1. Remote Deactivation Grace Dialog Fix

**Problem**: Remote deactivation didn't show Grace Period dialog
**Root Cause**: `showGracePeriodDialog` flag was false for remote deactivations
**Solution** (`main.js:remote deactivation handler`):
```javascript
if (trialStatus.phase === 'grace') {
    // FORCE show grace period dialog for remote deactivation
    console.log('ğŸš¨ FORCE showing Grace Period dialog due to remote deactivation');
    showGracePeriodDialog(trialStatus);  // Ignore showGracePeriodDialog flag
}
```

### 2. License Key Persistence Bug

**Problem**: License key remembered after deactivation
**Root Cause**: Incomplete clearing - only file cache was cleared
**Solution**: Multi-layer amnesia system clearing ALL storage locations

### 3. Server-side Hardcoded Values Override

**Problem**: Client restored timer values overridden by server defaults
**Root Cause**: Missing `timerUpdate` socket handler in server
**Solution**: Added proper server handler to accept client timer state

---

## ğŸ“‹ TESTING SCENARIOS & VALIDATION

### Complete Test Matrix

**Scenario 1: First-time Installation**
- [ ] New machine gets 10-day trial (1 minute for testing)
- [ ] Trial countdown displays correctly
- [ ] Grace period activates after trial expiration
- [ ] App terminates after grace period

**Scenario 2: License Activation**
- [ ] Valid license key activates successfully
- [ ] License persists across app restarts
- [ ] Machine appears in online admin panel
- [ ] Status shows "Active" Î¼Îµ correct machine name

**Scenario 3: Manual Deactivation**
- [ ] "Deactivate Machine" button clears license immediately
- [ ] Grace Period dialog appears
- [ ] All license data cleared (complete amnesia)
- [ ] Machine status changes in admin panel

**Scenario 4: Remote Deactivation**
- [ ] Admin panel deactivation detected by app
- [ ] Grace Period dialog appears (forced display)
- [ ] Complete license amnesia executed
- [ ] Consistent UX Î¼Îµ manual deactivation

**Scenario 5: Machine Conflict**
- [ ] Second PC activation Î¼Îµ same license key rejected
- [ ] Error message shows first machine name
- [ ] License remains active on original machine
- [ ] Clear instructions Î³Î¹Î± deactivation process

**Scenario 6: Future License Testing**
- [ ] After deactivation, new license key can be entered
- [ ] New license activates normally
- [ ] Previous license completely forgotten
- [ ] No interference between old/new licenses

---

## ğŸ—ï¸ ARCHITECTURE OVERVIEW

### Component Interaction Map

```
[UI Input] â†â†’ [License Manager] â†â†’ [Server Validator] â†â†’ [Online API]
     â†•              â†•                     â†•              â†•
[Local Storage] [Cache Files]    [Trial Manager]   [Machine DB]
     â†•              â†•                     â†•              â†•
[Session Data] [Auto-save]      [Grace Period]    [Admin Panel]
```

### Data Flow Î³Î¹Î± License Lifecycle

```
Installation â†’ Trial Period â†’ [License Entry OR Grace Period]
                                      â†“
                               License Validation
                                      â†“
                            Active License State
                                      â†“
                          [Deactivation Trigger]
                                      â†“
                            Complete Amnesia
                                      â†“
                              Grace Period
                                      â†“
                          [New License OR Exit]
```

---

## ğŸ”® FUTURE ENHANCEMENTS & CONSIDERATIONS

### Potential Improvements

**1. Heartbeat System**
- Continuous `last_seen` updates during app usage
- True "machine offline" detection
- Real-time machine status in admin panel

**2. License Transfer System**
- Automated deactivation of old machine when activating new one
- User-friendly machine migration process
- Email notifications Î³Î¹Î± license transfers

**3. Advanced Trial Management**
- Different trial periods Î³Î¹Î± different license types
- Trial extension capabilities
- Usage analytics during trial period

**4. Enhanced Security**
- License key encryption ÏƒÏ„Î± local storage
- Tamper detection Î³Î¹Î± cache files
- Advanced machine fingerprinting

---

## âš ï¸ CRITICAL DEBUGGING PATTERNS Î³Î¹Î± Future Claude Sessions

### Common Issues & Solutions

**1. License Key Still Remembered After Deactivation**
- âœ… Check ALL storage locations (localStorage, sessionStorage, cache files, global variables)
- âœ… Verify `clearAllLicenseData()` method execution
- âœ… Check server-side deactivation confirmation
- âœ… Ensure UI input fields are cleared via IPC

**2. Grace Period Dialog Not Showing**
- âœ… Check `showGracePeriodDialog` flag (should be ignored for remote deactivation)
- âœ… Verify trial status phase detection
- âœ… Ensure dialog functions are properly loaded
- âœ… Check IPC communication between main and renderer processes

**3. Server Values Override Client State**
- âœ… Check for hardcoded values in server timerState
- âœ… Verify socket event handlers exist (e.g., `timerUpdate`)
- âœ… Ensure bi-directional sync implementation
- âœ… Check server handler priority vs client values

**4. Machine Conflict Detection Issues**
- âœ… Verify online server connectivity
- âœ… Check license key format ÎºÎ±Î¹ validation
- âœ… Ensure machine fingerprint uniqueness
- âœ… Test error message display Î¼Îµ actual machine names

---

## ğŸ¯ PRODUCTION READINESS CHECKLIST

### Final Validation Status

- âœ… **Complete License Amnesia**: Multi-layer clearing implemented ÎºÎ±Î¹ tested
- âœ… **Grace Period System**: Consistent dialog display Î³Î¹Î± both manual ÎºÎ±Î¹ remote deactivation
- âœ… **Machine Conflict Detection**: 1-license-per-machine policy enforced
- âœ… **Real-time UI Updates**: Server monitoring ÎºÎ±Î¹ client sync operational
- âœ… **Trial Period Management**: 10-day trial Î¼Îµ proper countdown ÎºÎ±Î¹ expiration
- âœ… **Server Integration**: Online validation, machine tracking, admin panel compatibility
- âœ… **Error Handling**: Comprehensive error catching ÎºÎ±Î¹ user-friendly messages
- âœ… **Cross-session Persistence**: License state maintained across app restarts
- âœ… **Future License Support**: System ready Î³Î¹Î± any new license keys

### User Experience Quality

- âœ… **Professional UX**: vMix-style behavior Î¼Îµ instant feedback
- âœ… **Zero Data Loss**: Multiple save triggers ensure no user changes lost
- âœ… **Consistent Dialogs**: Same Grace Period experience Î³Î¹Î± all deactivation methods
- âœ… **Clear Error Messages**: Helpful guidance Î³Î¹Î± license conflicts ÎºÎ±Î¹ issues
- âœ… **Real-time Status**: Live updates Î³Î¹Î± trial countdown, grace period, license status

---

**ğŸ“ Î¤Î•Î›Î™ÎšÎ— Î£Î—ÎœÎ•Î™Î©Î£Î—**: Î‘Ï…Ï„ÏŒÏ‚ Î¿ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯ Ï„Î¿Î½ "ÏƒÎºÎ¿Ï€ÏŒ Î¶Ï‰Î®Ï‚" Î³Î¹Î± Ï„Î¿ licensing system Ï„Î¿Ï… TimeCastÂ® Pro. ÎšÎ¬Î¸Îµ Î¼ÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ® Claude session Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¹Î±Ï„Î·ÏÎµÎ¯ ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎµÎ¹ Î±Ï…Ï„Î® Ï„Î·Î½ Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ®, ÎµÎ¾Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ ÏŒÏ„Î¹ ÏŒÎ»Î± Ï„Î± components Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ Î¼Îµ real-time UI updates ÎºÎ±Î¹ enterprise-grade reliability.

**ğŸ”§ Status**: âœ… **PRODUCTION READY** - Complete testing performed, all scenarios validated, zero known issues remaining.

## SYSTEM PHASES

### Phase 1: TRIAL PERIOD â±ï¸
- **Duration**: 10 days Î³Î¹Î± production (1 Î»ÎµÏ€Ï„ÏŒ Î³Î¹Î± testing)
- **Behavior**: Î Î»Î®ÏÎ·Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚
- **Files**: `trial.json` Î¼Îµ motherboard fingerprint
- **UI/UX**: Title bar Î´ÎµÎ¯Ï‡Î½ÎµÎ¹: "TimeCast Pro - Trial: X days remaining"
- **Countdown Display**: Î‘Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î¿Ï‚ Ï‡ÏÎ¿Î½Î¿Î¼Î­Ï„ÏÎ·ÏƒÎ· ÏƒÏ„Î·Î½ title bar ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Î¿Ï… trial
- **Status**: Î•Î½ÎµÏÎ³Î® Ï‡ÏÎ®ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚
- **End Condition**: Î£Ï„Î¿ Ï„Î­Î»Î¿Ï‚ â†’ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î¼ÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÎµ Grace Period

### Phase 2: GRACE PERIOD ğŸ””
- **Duration**: 5 Î»ÎµÏ€Ï„Î¬ (ÏƒÏ„Î±Î¸ÎµÏÏŒ)
- **Behavior**: Countdown ÏƒÏ„Î¿Î½ Ï„Î¯Ï„Î»Î¿ + custom in-app dialog
- **Custom Dialog Requirements**:
  - **Type**: Custom HTML dialog ÎœÎ•Î£Î‘ ÏƒÏ„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® (ÏŒÏ‡Î¹ native Electron dialog)
  - **Design**: Pop-up style Ï€Î¿Ï… ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ over Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®
  - **Trigger**: Î•Î¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… Grace Period
  - **Visibility**: ÎšÎ‘Î˜Î• Î¦ÎŸÎ¡Î‘ Ï€Î¿Ï… Î±Î½Î¿Î¯Î³ÎµÎ¹ Î· ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î¼ÎµÏ„Î¬ Ï„Î¿ trial expiry
  - **Message**: "âš ï¸ Î— trial Ï€ÎµÏÎ¯Î¿Î´Î¿Ï‚ Î­Ï‡ÎµÎ¹ Î»Î®Î¾ÎµÎ¹. Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î¸Î± Ï„ÎµÏÎ¼Î±Ï„Î¹ÏƒÏ„ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÏƒÎµ 5 Î»ÎµÏ€Ï„Î¬."
  - **Styling**: Professional pop-up design Î¼Îµ TimeCast branding
- **Dialog Buttons**:
  - **"Î‘Î³Î¿ÏÎ¬ ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î†Î´ÎµÎ¹Î±Ï‚"** â†’ Opens browser Î¼Îµ purchase URL + ÎºÏÎ±Ï„Î¬ÎµÎ¹ dialog Î±Î½Î¿Î¹Ï‡Ï„ÏŒ + continues countdown
  - **"ÎˆÎ¾Î¿Î´Î¿Ï‚"** â†’ Immediate process.exit(0) + ÎºÎ»ÎµÎ¯Î½ÎµÎ¹ dialog
- **User Experience**:
  - Dialog ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚
  - Semi-transparent background overlay
  - Clear, readable typography
  - Professional button styling
- **End Condition**: Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ Ï„ÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼ÏŒ Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Î¼ÎµÏ„Î¬ Ï„Î± 5 Î»ÎµÏ€Ï„Î¬
- **Files**: `grace-period.json` Î¼Îµ timestamp

### Phase 3: ACTIVE LICENSE âœ…
- **Activation**: License key entry ÏƒÏ„Î¿ Settings modal â†’ server validation â†’ machine activation
- **1-Machine Policy**: ÎšÎ¬Î¸Îµ license key = 1 PC (hardware fingerprint-based)
- **Server Communication**: timecast.eu licensing API Î¼Îµ hardware binding
- **Validation**: Real-time server validation Î¼Îµ 7-day offline grace
- **Status**: Î Î»Î®ÏÎ·Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚
- **UI/UX**: Title bar Î´ÎµÎ¯Ï‡Î½ÎµÎ¹: "TimeCast Pro - Licensed"

**LICENSE KEY MANAGEMENT**:
- **Entry Point**: Settings modal â†’ License Management section
- **Activation Flow**: License key â†’ Hardware fingerprinting â†’ Server validation â†’ Machine activation
- **1-Machine Enforcement**: Server rejects activation ÎµÎ¬Î½ Ï„Î¿ license key is already active on different hardware
- **Transfer Process**: User must deactivate Î±Ï€ÏŒ previous PC Î³Î¹Î± Î½Î± activate ÏƒÎµ Î½Î­Î¿ PC
- **Deactivation Consequences**: Î•Î¬Î½ user deactivates Ï„Î¿ active license â†’ App ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ ÏƒÎµ Grace Period (5 Î»ÎµÏ€Ï„Î¬)

**ANTI-ABUSE LOGIC**:
- **Server Validation**: timecast.eu server enforces 1-machine-per-license policy
- **Hardware Binding**: License tied to motherboard serial + UUID + BIOS serial
- **Rejection Response**: "License already activated on different machine" ÎµÎ¬Î½ user tries 2nd PC
- **Grace Period Trigger**: License deactivation â†’ immediate Grace Period start

**ğŸš¨ OFFLINE FRAUD PREVENTION**:
**Scenario**: User activates PC1 â†’ goes offline â†’ tries same license on PC2
**Database State**: License key already bound to PC1 hardware fingerprint
**Server Response**: PC2 activation REJECTED Î¼Îµ "MACHINE_LIMIT_EXCEEDED"
**Result**: PC2 Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ ÏƒÎµ Trial/Grace Period, PC1 has valid license (7-day offline grace)
**Why It Fails**: Server database Î¼Î½Î·Î¼Î¿Î½ÎµÏÎµÎ¹ PC1 fingerprint, PC2 fingerprint â‰  PC1 fingerprint
**Additional Security**: 7-day offline limit forces eventual online validation

## TECHNICAL REQUIREMENTS

### Startup Logic ğŸ”
**Priority Order (ÎšÎ¡Î™Î£Î™ÎœÎŸ)**:
1. **ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ License Key Ï€ÏÏÏ„Î±** â†’ Î•Î¬Î½ valid, skip ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±
2. **ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Trial Status** â†’ Î•Î¬Î½ ÎµÎ½ÎµÏÎ³ÏŒ, ÏƒÏ…Î½ÎµÏ‡Î¯Î¶ÎµÎ¹ trial
3. **ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Grace Period** â†’ Î•Î¬Î½ ÎµÎ½ÎµÏÎ³ÏŒ, ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ dialog
4. **Default**: ÎÎµÎºÎ¹Î½Î¬ÎµÎ¹ Î½Î­Î¿ trial ÎµÎ¬Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ files

**File Checks**:
- `trial.json` - Trial state Î¼Îµ motherboard fingerprint
- `grace-period.json` - Grace period timestamp
- `license.json` - Local license cache
- ÎŒÎ»Î± Ï„Î± files ÎµÎ¯Î½Î±Î¹ hardware-specific

**Decision Tree**:
```
App Start â†’ License Valid? â†’ YES: Start Licensed Mode
         â†’ NO: Trial Expired? â†’ NO: Continue Trial
                             â†’ YES: Grace Active? â†’ YES: Show Dialog + Start Grace
                                                 â†’ NO: Start New Trial
```

### User Experience ğŸ¯
**Dialog Behavior**:
- **Î¥Î ÎŸÎ§Î¡Î•Î©Î¤Î™ÎšÎŸ**: Dialog ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ ÎšÎ‘Î˜Î• startup Î¼ÎµÏ„Î¬ Ï„Î¿ trial expiry
- **Professional Look**: Electron native dialog Î¼Îµ proper buttons
- **Clear Messages**: Î•Î»Î»Î·Î½Î¹ÎºÎ¬ messages Î¼Îµ ÏƒÎ±Ï†ÎµÎ¯Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚
- **Immediate Response**: "ÎˆÎ¾Î¿Î´Î¿Ï‚" = instant process.exit(0)

**Professional Requirements**:
- Î”ÎµÎ½ ÎµÎ¯Î½Î±Î¹ annoying - Î¼ÏŒÎ½Î¿ Î¼ÎµÏ„Î¬ Ï„Î¿ legitimate trial expiry
- Clear licensing path Î¼Îµ direct browser link
- Transparent countdown ÏƒÏ„Î¿Î½ title bar
- Proper app termination (ÏŒÏ‡Î¹ crashes)

**Countdown Display**:
- **Trial Period**: "TimeCast Pro - Trial: 8 days 14:32:45 remaining"
- **Grace Period**: "TimeCast Pro - Grace: 4:32 remaining"
- Updates every second
- Visible ÏƒÎµ ÏŒÎ»Î± Ï„Î± windows
- Real-time Î±Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î¿Ï‚ Ï‡ÏÎ¿Î½Î¿Î¼Î­Ï„ÏÎ·ÏƒÎ·

### Security & Anti-Abuse ğŸ”’
**Hardware Fingerprinting - ÎšÎ¡Î™Î£Î™ÎœÎŸ Î“Î™Î‘ ANTI-ABUSE**:

**Î£ÎšÎ›Î—Î¡Î‘ Î”Î•Î”ÎŸÎœÎ•ÎÎ‘ (Immutable - Î”ÎµÎ½ Î±Î»Î»Î¬Î¶Î¿Ï…Î½ ÎµÏÎºÎ¿Î»Î±)**:
1. **Motherboard Serial Number** (1Î· Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±)
   - `wmic baseboard get serialnumber`
   - Î‘Î´ÏÎ½Î±Ï„Î¿ Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ Ï‡Ï‰ÏÎ¯Ï‚ Î±Î»Î»Î±Î³Î® motherboard
2. **Motherboard UUID** (2Î· Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±)
   - `wmic csproduct get uuid`
   - Hardware-based, Î¼ÏŒÎ½Î¹Î¼Î¿
3. **BIOS Serial Number** (3Î· Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±)
   - `wmic bios get serialnumber`
   - Firmware-level, Î´ÏÏƒÎºÎ¿Î»Î¿ Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹

**FALLBACK HIERARCHY** (Î•Î¬Î½ Ï„Î± Ï€Î¬Î½Ï‰ Î±Ï€Î¿Ï„ÏÏ‡Î¿Ï…Î½):
4. **CPU ID + Motherboard Product**
   - Î£Ï…Î½Î´Ï…Î±ÏƒÎ¼ÏŒÏ‚ ÏƒÎºÎ»Î·ÏÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
   - `wmic cpu get processorid` + `wmic baseboard get product`

**âŒ ÎœÎ‘Î›Î‘ÎšÎ‘ Î”Î•Î”ÎŸÎœÎ•ÎÎ‘ - ÎœÎ— Î§Î¡Î—Î£Î—**:
- âŒ PC Name (ÎµÏÎºÎ¿Î»Î· Î±Î»Î»Î±Î³Î®)
- âŒ RAM Size (Î±Î»Î»Î¬Î¶ÎµÎ¹ Î¼Îµ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·/Î±Ï†Î±Î¯ÏÎµÏƒÎ·)
- âŒ Hard Drive Size (Î±Î»Î»Î¬Î¶ÎµÎ¹ Î¼Îµ Î±Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ·)
- âŒ Network MAC Address (spoofable)
- âŒ Username (Î±Î»Î»Î¬Î¶ÎµÎ¹ ÎµÏÎºÎ¿Î»Î±)

**ANTI-ABUSE Î£Î¤Î¡Î‘Î¤Î—Î“Î™ÎšÎ—**:
- **Î£ÎºÎ»Î·ÏÎ® Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·**: Trial tied ÏƒÏ„Î± Î£ÎšÎ›Î—Î¡Î‘ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î¼ÏŒÎ½Î¿
- **Combo Fingerprint**: Î§ÏÎ®ÏƒÎ· 2-3 ÏƒÎºÎ»Î·ÏÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î¼Î±Î¶Î¯
- **Server-side validation**: Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· fingerprint ÏƒÏ„Î¿Î½ server
- **Detection**: Î•Î¬Î½ Î±Î»Î»Î¬Î¾Î¿Ï…Î½ Ï„Î± ÏƒÎºÎ»Î·ÏÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î± = Î½Î­Î¿ PC = Î½Î­Î¿ trial (legitimate)

**File Management**:
- Trial files tied to IMMUTABLE hardware fingerprint
- Different MOTHERBOARD = Î½Î­Î¿ legitimate trial
- Files stored ÏƒÎµ app directory (ÏŒÏ‡Î¹ system-wide)
- Safe deletion Î¼Îµ Windows Recycle Bin support

**State Persistence**:
- All timing data stored Î¼Îµ timestamps
- Server-side trial database Î¼Îµ Î£ÎšÎ›Î—Î¡ÎŸ fingerprint
- Fallback ÏƒÎµ local files Î±Î½ server unavailable
- **Anti-Abuse**: Î£ÎšÎ›Î—Î¡Î— hardware change detection Î¼ÏŒÎ½Î¿

## IMPLEMENTATION STRATEGY ğŸš€

### Phase A: Core Trial System
**Priority**: Î¥Î¨Î—Î›Î—
- Rebuild `trial-manager.js` Î¼Îµ clean architecture
- Hardware fingerprinting system
- File-based state management
- Basic trial countdown

### Phase B: Grace Period Logic
**Priority**: ÎšÎ¡Î™Î£Î™ÎœÎ—
- Grace period activation Î¼ÎµÏ„Î¬ trial expiry
- Dialog system Î¼Îµ proper button handling
- Title bar countdown integration
- Automatic app termination

### Phase C: License Integration
**Priority**: ÎœÎ•Î£Î‘Î™Î‘
- Server-based license validation
- Local license cache fallback
- Integration Î¼Îµ existing license system
- Professional licensed mode

### Phase D: Polish & Testing
**Priority**: Î§Î‘ÎœÎ—Î›Î—
- Error handling improvements
- UI/UX refinements
- Debug flags for testing
- Documentation & maintenance

## CRITICAL SUCCESS FACTORS âš ï¸

### MUST HAVE Î³Î¹Î± Production
1. **Startup Logic Priority**: License Check â†’ Trial Check â†’ Grace Check â†’ Default
2. **Dialog Every Time**: ÎšÎ‘Î˜Î• app startup Î¼ÎµÏ„Î¬ trial expiry
3. **Immediate Exit**: "ÎˆÎ¾Î¿Î´Î¿Ï‚" button = instant process.exit(0)
4. **Hardware Security**: Trial tied to machine fingerprint
5. **Professional UX**: Clear messages, countdown, proper termination

### TESTING REQUIREMENTS
- **Development**: 1-minute trial, 5-minute grace Î³Î¹Î± quick testing
- **Production**: 10-day trial, 5-minute grace Î³Î¹Î± real deployment
- **Safe Reset**: Windows Recycle Bin support Î³Î¹Î± file cleanup
- **Debug Flags**: FORCE_TRIAL_TESTING Î³Î¹Î± bypassing license system

---

**STATUS**: âœ… Documentation Complete
**LAST UPDATED**: 2025-09-24
**NEXT STEPS**: Begin implementation based on this comprehensive documentation
